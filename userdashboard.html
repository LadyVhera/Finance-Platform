<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TPT M√©xico ‚Äî User Dashboard</title>
    <meta name="description"
        content="TPT dashboard for participants ‚Äî requests, transfers, wallet, messages, referrals, verification, settings, policies, and support." />
    <!-- Fonts & CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="style copy.css" />

    <style>
        /* layout */
        .layout {
            display: flex;
            min-height: 100dvh;
            background: var(--bg);
            color: var(--ink);
        }

        /* FIX: give sidebar a real background and its own stacking context */
        .sidebar {
            width: 280px;
            flex: 0 0 280px;
            background: linear-gradient(180deg, rgba(15, 23, 48, 0.98) 0%, rgba(10, 16, 34, 0.98) 100%);
            /* opaque/frosted */
            /* or use a solid color: background: var(--panel); */
            border-right: 1px solid rgba(255, 255, 255, .06);
            position: sticky;
            top: 0;
            height: 100dvh;
            z-index: 100;
            /* sit above content shadows */
        }

        /* main content area */
        .content {
            flex: 1 1 auto;
            /* padding: 16px; */
            background: radial-gradient(1200px 600px at 20% -10%, rgba(0, 224, 255, .06), transparent 60%) var(--bg);
        }

        /* helpful visuals for cards/panels if you use them elsewhere */
        .cardx,
        .panel {
            background: rgba(255, 255, 255, .03);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 14px;
        }

        /* nav-pills inside the sidebar */
        .sidebar .nav-link {
            color: var(--muted);
            border-radius: 10px;
        }

        .sidebar .nav-link.active {
            color: var(--ink);
            background: linear-gradient(90deg, var(--accent2), var(--accent1));
            box-shadow: 0 8px 26px rgba(0, 224, 255, .15);
        }

        .sidebar .nav-link:hover {
            background: rgba(255, 255, 255, .06);
            color: var(--ink);
        }

        /* brand area in sidebar */
        .sidebar .brand {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px 12px;
        }

        .sidebar .brand .logo {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: grid;
            place-items: center;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent2), var(--accent1));
            color: #001425;
        }

        /* avatars, chips, etc. */
        .avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .badge-soft {
            background: rgba(255, 255, 255, .08);
            color: var(--ink);
            border-radius: 999px;
        }

        /* progress bars on dark */
        .progress {
            background: rgba(255, 255, 255, .08);
            height: 8px;
            border-radius: 999px;
        }

        .progress .progress-bar {
            background: linear-gradient(90deg, var(--accent2), var(--accent1));
        }

        .btn {
            border: none;
            font-weight: 700;
            border-radius: 12px;
            transition: transform .18s ease, box-shadow .28s ease, filter .2s ease, background .28s ease, color .28s ease
        }

        .btn,
        .btn-primary,
        .btn-success,
        .btn-danger,
        .btn-warning,
        .btn-info {
            background: linear-gradient(90deg, var(--accent2), var(--accent1));
            color: var(--btn-text);
            box-shadow: 0 6px 20px rgba(0, 112, 255, .12)
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 224, 255, .18)
        }

        .btn-outline-light {
            background: transparent !important;
            color: #e6f0ff !important;
            border: 1px solid rgba(255, 255, 255, .18) !important;
            box-shadow: none !important
        }

        .btn-outline-light:hover {
            background: linear-gradient(90deg, var(--accent2), var(--accent1)) !important;
            color: var(--btn-text) !important;
            border-color: transparent !important;
            box-shadow: 0 12px 40px rgba(0, 224, 255, .18) !important
        }

        .cardx {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 14px;
            transition: transform .18s ease, box-shadow .28s ease
        }

        .cardx:hover {
            transform: translateY(-4px);
            box-shadow: 0 18px 50px rgba(1, 9, 26, .6)
        }

        .muted {
            color: var(--muted)
        }

        .badge-soft {
            background: black;
            color: #bff3ff;
            border: 1px solid rgba(102, 224, 255, .25)
        }

        .progress {
            background: rgba(255, 255, 255, .06);
            height: 8px;
            border-radius: 999px
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--accent2), var(--accent1))
        }

        .layout {
            display: grid;
            grid-template-columns: 270px 1fr;
            min-height: 100vh
        }

        .sidebar {
            background: var(--sidebar);
            border-right: 1px solid rgba(255, 255, 255, .06);
            position: sticky;
            top: 0;
            height: 100vh;
            padding: 14px;
            overflow: auto
        }

        .brand {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 10px 8px
        }

        .brand .logo {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: grid;
            place-items: center;
            background: linear-gradient(90deg, var(--accent2), var(--accent1));
            color: #fff;
            font-weight: 800
        }

        .nav-link {
            color: #cbd5e1;
            border-radius: 10px;
            padding: 10px 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, .06);
            color: #fff
        }

        .nav-link.active {
            background: linear-gradient(90deg, rgba(0, 114, 255, .18), rgba(0, 224, 255, .18));
            color: #fff;
            border: 1px solid rgba(0, 224, 255, .18);
            text-shadow: 0 0 10px rgba(0, 224, 255, .35)
        }

        .content {
            padding: 16px
        }

        .topbar {
            position: sticky;
            top: 0;
            z-index: 10;
            background: rgba(12, 18, 36, .6);
            /* backdrop-filter: blur(1px); */
            border-bottom: 1px solid rgba(255, 255, 255, .06);
            padding: 10px 16px;
            border-radius: 14px
        }

        .section-title {
            position: relative;
            color: #fff;
            margin-bottom: 8px
        }

        .section-title::after {
            content: "";
            display: block;
            height: 2px;
            margin: 12px 0 0;
            background: linear-gradient(90deg, transparent, var(--accent1), transparent);
            border-radius: 6px
        }

        .kpi {
            display: flex;
            gap: 14px;
            align-items: center
        }

        .kpi .stat {
            font-size: clamp(1.5rem, 3vw, 2.2rem);
            font-weight: 800
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(255, 255, 255, .18)
        }

        .table-dark {
            --bs-table-bg: #0e1731;
            --bs-table-striped-bg: #111d3b;
            --bs-table-hover-bg: #0f1a35
        }

        .form-control,
        .form-select {
            background: #0c1328;
            color: var(--ink);
            border: 1px solid rgba(255, 255, 255, .12)
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--accent1);
            box-shadow: 0 0 0 .16rem rgba(0, 224, 255, .15)
        }

        .kanban {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px
        }

        .kanban-col {
            background: #0d1731;
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 12px;
            padding: 10px
        }

        .kanban-col h6 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0 0 8px
        }

        .req-card {
            background: #0f1833;
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 10px
        }

        .req-card .title {
            font-weight: 600
        }

        .req-card .meta {
            font-size: .8rem;
            color: #9fb0c9
        }

        .alert-note {
            border: 1px dashed rgba(255, 255, 255, .2);
            background: rgba(0, 224, 255, .05)
        }


        /* --- TPT School extras (uses your palette) --- */
        .panel {
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, .06);
            border-radius: 16px;
        }

        .chip {
            border: 1px solid rgba(255, 255, 255, .18);
            background: rgba(255, 255, 255, .06);
            color: #d5e9ff;
            border-radius: 999px;
            padding: .2rem .6rem;
            font-size: .75rem;
        }

        .side-rail {
            position: sticky;
            top: 74px;
        }

        .footer {
            border-top: 1px solid rgba(255, 255, 255, .06);
        }

        .btn-ghost {
            background: transparent;
            color: #e6f0ff;
            border: 1px solid rgba(255, 255, 255, .18);
        }

        .btn-ghost:hover {
            background: linear-gradient(90deg, var(--accent2), var(--accent1));
            color: var(--btn-text);
            border-color: transparent;
            box-shadow: 0 12px 40px rgba(0, 224, 255, .18);
        }

        @media (max-width:991.98px) {
            .layout {
                grid-template-columns: 1fr
            }

            .sidebar {
                position: fixed;
                left: -100%;
                top: 0;
                height: 100vh;
                width: 280px;
                z-index: 1050;
                transition: left .25s ease;
                background: linear-gradient(180deg, rgba(15, 23, 48, 0.98) 0%, rgba(10, 16, 34, 0.98) 100%) !important;
                backdrop-filter: blur(12px);
                border-right: 1px solid rgba(255, 255, 255, 0.06);
            }

            .sidebar.open {
                left: 0
            }

            .content {
                padding: 10px
            }

            .topbar {
                border-radius: 10px
            }

            .kanban {
                grid-template-columns: 1fr
            }
        }

        /* Make the role "badge" feel like a pill toggle */
        .badge-soft.dropdown-toggle {
            border-radius: 999px;
            padding: .25rem .6rem;
            border: 1px solid rgba(102, 224, 255, .25);
        }

        /* Remove focus ring around avatar button */
        .dropdown>.btn.bg-transparent:focus {
            box-shadow: none;
        }

        .sidebar {
            background: var(--panel);
            /* ‚Ä¶rest unchanged‚Ä¶ */
        }

        /* ========== Policies Layout ========== */
.policy-wrap{display:grid;grid-template-columns:310px 1fr;gap:16px}
.policy-card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:14px}
.policy-hero{background:linear-gradient(135deg,rgba(0,224,255,.06),rgba(0,114,255,.05)) var(--card)}
.policy-badge{border:1px solid rgba(102,224,255,.25);background:rgba(255,255,255,.06);color:#d5e9ff;border-radius:999px;padding:.15rem .5rem}
.policy-toc{position:sticky;top:74px;height:max-content}
.policy-nav .nav-link{display:flex;align-items:center;gap:.5rem;padding:.45rem .6rem;border-radius:10px;color:#cbd5e1}
.policy-nav .nav-link:hover{background:rgba(255,255,255,.06);color:#fff}
.policy-nav .nav-link.active{background:linear-gradient(90deg,rgba(0,114,255,.18),rgba(0,224,255,.18));border:1px solid rgba(0,224,255,.18);color:#fff}
.policy-h{position:relative;margin:0 0 .5rem}
.policy-h::after{content:"";display:block;height:2px;margin:.6rem 0 0;background:linear-gradient(90deg,transparent,var(--accent1),transparent);border-radius:6px}
.policy-list{margin:0;padding-left:1.1rem}
.policy-list li{margin:.25rem 0}
.policy-steps{margin:0 0 .75rem;padding-left:1.2rem}
.policy-callout{display:flex;gap:.6rem;align-items:flex-start;border:1px dashed rgba(255,255,255,.22);background:rgba(0,224,255,.05);border-radius:12px;padding:.75rem;margin:.6rem 0}
.policy-callout.warn{background:rgba(255,153,0,.06);border-color:rgba(255,153,0,.28)}
.policy-quote{border-left:3px solid var(--accent1);padding-left:.75rem;color:#cfe6ff}
.policy-tip{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.06);border-radius:12px}

@media (max-width: 991.98px){
  .policy-wrap{grid-template-columns:1fr}
  .policy-toc{position:static}
}

/* Slim progress bar pinned to top of the policies content */
.policy-progress{
  position: sticky; top: 0; left: 0; right: 0; height: 3px;
  background: rgba(255,255,255,.06); border-radius: 999px; overflow: hidden; z-index: 5;
  margin: -6px 0 10px; /* visually tucked into card spacing */
}
.policy-progress__bar{
  height: 100%; width: 0%;
  background: linear-gradient(90deg,var(--accent2),var(--accent1));
  transition: width .15s linear;
}

/* Floating accept bar that appears mid-scroll */
.policy-cta{
  position: sticky; bottom: 12px; z-index: 6;
  background: rgba(12,18,36,.75); backdrop-filter: blur(8px);
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 12px; padding: .6rem .75rem; display:none;
}
.policy-cta.show{ display:block; }

/* TOC polish: pill bullets and glow on active */
.policy-nav .nav-link{
  position: relative; padding-left: 2rem;
}
.policy-nav .nav-link::before{
  content:""; position:absolute; left:.6rem; top:50%; transform:translateY(-50%);
  width:.5rem; height:.5rem; border-radius:50%;
  background: rgba(255,255,255,.25);
  box-shadow: 0 0 0 0 rgba(0,224,255,.0);
  transition: all .2s ease;
}
.policy-nav .nav-link.active::before{
  background: var(--accent1);
  box-shadow: 0 0 0 6px rgba(0,224,255,.12);
}

/* Lists with subtle check icons */
.policy-list{ list-style: none; padding-left: 0; }
.policy-list li{
  position: relative; padding-left: 1.35rem; margin:.35rem 0;
}
.policy-list li::before{
  content: "‚úì";
  position: absolute; left:0; top:.05rem;
  font-weight: 800; font-size: .9rem; color: #bff3ff;
}

/* Section cards: a little depth and border glow on hover */
.policy-card{
  box-shadow: 0 10px 30px rgba(1,9,26,.25);
  transition: transform .16s ease, box-shadow .2s ease, border-color .2s ease;
}
.policy-card:hover{
  transform: translateY(-2px);
  border-color: rgba(0,224,255,.18);
  box-shadow: 0 16px 50px rgba(1,9,26,.45);
}

/* Mobile: tuck the CTA nicely */
@media (max-width: 991.98px){
  .policy-cta{ bottom: 8px; }
}

/* === Support page polish === */
.sup-hero{
  background: radial-gradient(800px 240px at 10% -30%, rgba(0,224,255,.08), transparent 60%) var(--card);
  border: 1px solid rgba(255,255,255,.06);
}
.sup-dot{
  width:10px;height:10px;border-radius:50%;
  background: #30d158; box-shadow: 0 0 12px rgba(48,209,88,.55);
  display:inline-block;
}
.sup-pill{
  border:1px solid rgba(255,255,255,.12);
  background: rgba(255,255,255,.04);
  color:#d5e9ff;border-radius:999px;padding:.2rem .6rem;font-size:.8rem;
}
.sup-quick .dropdown-item{ font-size:.9rem; }
.sup-quick .dropdown-item i{ opacity:.9; }

#formSupport .form-control, #formSupport .form-select{ background:#0b142b; }
#supFileName{ opacity:.8; }

.sup-faq .accordion-button{
  background: rgba(255,255,255,.02);
  color: var(--ink);
  border-bottom: 1px solid rgba(255,255,255,.06);
}
.sup-faq .accordion-button:not(.collapsed){
  background: rgba(0,224,255,.06);
  color:#e6f5ff;
}

/* ‚ÄúStill need help‚Äù card subtle lift */
.sup-helpmore{ border:1px dashed rgba(255,255,255,.12); background: rgba(255,255,255,.03); }

/* === Fix: FAQ text contrast & backgrounds === */
.sup-faq .accordion-item { border: 1px solid rgba(255,255,255,.08); border-radius: 12px; overflow: hidden; }
.sup-faq .accordion-item + .accordion-item { margin-top: .5rem; }

.sup-faq .accordion-button{
  background: #0b142b;           /* darker panel */
  color: #e6f0ff;                /* high-contrast text */
  border-bottom: 1px solid rgba(255,255,255,.06);
}
.sup-faq .accordion-button:not(.collapsed){
  background: #0e1d3d;           /* active darker */
  color: #eaf4ff;
}

/* Chevron icon visible on dark */
.sup-faq .accordion-button::after{
  filter: invert(1) opacity(.9); /* make the caret light */
}

/* Body text contrast */
.sup-faq .accordion-body{
  background: #0b142b;           /* match header bg */
  color: #cfe6ff;                /* readable body copy */
}

/* Optional: remove bright focus ring on dark */
.sup-faq .accordion-button:focus{
  box-shadow: 0 0 0 .16rem rgba(0,224,255,.15);
}

    </style>

</head>

<body>

    <div class="layout">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="brand mb-2">
                <div class="logo">TPT</div>
                <div>
                    <div class="fw-bold">TPT Dashboard</div>
                    <small class="muted">People Helping People</small>
                </div>
            </div>

            <!-- UPDATED: Proper tablist with data-bs-target -->
            <nav class="nav nav-pills flex-column gap-1" id="dashboardTabs" role="tablist">
                <a id="tablink-overview" class="nav-link active" role="tab" aria-selected="true" data-bs-toggle="tab"
                    data-bs-target="#tab-overview">
                    <i class="bi bi-speedometer2"></i> Overview
                </a>
                <a id="tablink-profile" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-profile">
                    <i class="bi bi-person-circle"></i> Profile
                </a>

                <a id="tablink-requests" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-requests">
                    <i class="bi bi-journal-plus"></i> My Requests
                </a>
                <a id="tablink-provide" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-provide">
                    <i class="bi bi-gift"></i> Provide Help
                </a>
                <a id="tablink-wallet" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-wallet">
                    <i class="bi bi-wallet2"></i> Wallet & Transactions
                </a>
                <a id="tablink-messages" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-messages">
                    <i class="bi bi-chat-dots"></i> Messages
                </a>
                <a id="tablink-referrals" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-referrals">
                    <i class="bi bi-people"></i> Referrals
                </a>
                <a id="tablink-verification" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-verification">
                    <i class="bi bi-shield-check"></i> Verification
                </a>
                <a id="tablink-school" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-school">
                    <i class="bi bi-mortarboard"></i> TPT School
                </a>

                <a id="tablink-settings" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-settings">
                    <i class="bi bi-gear"></i> Settings
                </a>
                <a id="tablink-policies" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-policies">
                    <i class="bi bi-file-text"></i> Policies
                </a>
                <a id="tablink-support" class="nav-link" role="tab" aria-selected="false" data-bs-toggle="tab"
                    data-bs-target="#tab-support">
                    <i class="bi bi-life-preserver"></i> Support
                </a>

            </nav>

            <div class="mt-3 small muted">
                <div class="fw-semibold mb-1">Quick actions</div>
                <div class="d-grid gap-2">
                    <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#modalNewRequest"><i
                            class="bi bi-plus-circle me-1"></i>New Request</button>
                    <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal"
                        data-bs-target="#modalSendHelp"><i class="bi bi-arrow-up-right-circle me-1"></i>Send
                        Help</button>
                </div>
            </div>

            <div class="mt-4">
                <div class="small muted">¬© <span id="year"></span> TPT M√©xico</div>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="content">
            <!-- TOPBAR -->
            <div class="topbar d-flex justify-content-between align-items-center mb-3">
                <div class="d-flex align-items-center gap-2">
                    <button class="btn btn-outline-light btn-sm d-lg-none" id="btnToggleSidebar">
                        <i class="bi bi-list"></i>
                    </button>
                    <div class="fw-semibold">Welcome back, <span id="usernameTop">Friend</span> üëã</div>
                </div>

                <div class="d-flex align-items-center gap-3">
                    <!-- Role (Member/Admin) as dropdown -->
                    <div class="dropdown">
                        <button class="btn btn-sm badge-soft dropdown-toggle d-inline-flex align-items-center"
                            id="roleDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-badge me-1"></i><span id="badgeRank">Member</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark" aria-labelledby="roleDropdown">
                            <li class="dropdown-header">Switch role</li>
                            <li><a class="dropdown-item role-option" data-role="Member" href="#">
                                    <i class="bi bi-people me-2"></i>Member</a></li>
                            <li><a class="dropdown-item role-option" data-role="Admin" href="#">
                                    <i class="bi bi-shield-lock me-2"></i>Admin</a></li>
                        </ul>
                    </div>

                    <!-- Notifications (unchanged) -->
                    <div class="position-relative">
                        <button class="btn btn-outline-light btn-sm" data-bs-toggle="dropdown"><i
                                class="bi bi-bell"></i></button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark">
                            <li class="dropdown-header">Notifications</li>
                            <li><a class="dropdown-item small" href="#">Your request #R-1201 was verified.</a></li>
                            <li><a class="dropdown-item small" href="#">Transfer received: ‚Ç±6,000</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#" id="openMessagesTab">
                                    <i class="bi bi-chat-dots me-2"></i>Messages</a></li>
                        </ul>
                    </div>

                    <!-- Avatar button opens user menu -->
                    <div class="dropdown">
                        <button class="btn p-0 border-0 bg-transparent" data-bs-toggle="dropdown" aria-expanded="false"
                            aria-label="User menu">
                            <img class="avatar"
                                src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=160&auto=format&fit=crop"
                                alt="user">
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-dark" style="min-width: 280px;">
                            <li class="dropdown-header">
                                <div class="fw-semibold" id="ddName">Friend</div>
                                <div class="small" id="ddEmail">friend@example.com</div>
                            </li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>

                            <li><a class="dropdown-item" href="#" id="openProfileTab">
                                    <i class="bi bi-person-circle me-2"></i>Profile</a></li>

                            <li><a class="dropdown-item" href="#" id="openSettingsTab">
                                    <i class="bi bi-gear me-2"></i>Settings</a></li>

                            <!-- FIX: change id to openSecurityTab (avoid colliding with pane id="tab-verification") -->
                            <li><a class="dropdown-item" href="#" id="openSecurityTab">
                                    <i class="bi bi-shield-check me-2"></i>Security</a></li>

                            <li><a class="dropdown-item" href="#" id="openBillingTab">
                                    <i class="bi bi-credit-card me-2"></i>Billing</a></li>

                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item text-warning" href="#" id="btnLoginAsAdmin">
                                    <i class="bi bi-door-open me-2"></i>Login as Admin</a></li>
                            <li><a class="dropdown-item text-danger" href="#" id="btnLogout">
                                    <i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
                        </ul>

                    </div>
                </div>
            </div>



            <div class="tab-content">

                <!-- OVERVIEW -->
                <section class="tab-pane fade show active" id="tab-overview" role="tabpanel"
                    aria-labelledby="tablink-overview">
                    <div class="row g-3">
                        <div class="col-xl-3 col-md-6">
                            <div class="cardx p-3 h-100">
                                <div class="kpi">
                                    <i class="bi bi-wallet2 fs-3 text-info"></i>
                                    <div>
                                        <div class="stat" id="kpiBalance">‚Ç±0</div>
                                        <div class="muted small">Wallet Balance</div>
                                    </div>
                                </div>
                                <div class="progress mt-3">
                                    <div class="progress-bar" id="pbBalance" style="width:0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="cardx p-3 h-100">
                                <div class="kpi">
                                    <i class="bi bi-activity fs-3 text-success"></i>
                                    <div>
                                        <div class="stat" id="kpiFulfillment">0%</div>
                                        <div class="muted small">Fulfillment Rate</div>
                                    </div>
                                </div>
                                <div class="progress mt-3">
                                    <div class="progress-bar" id="pbFulfillment" style="width:0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="cardx p-3 h-100">
                                <div class="kpi">
                                    <i class="bi bi-arrow-down-circle fs-3 text-warning"></i>
                                    <div>
                                        <div class="stat" id="kpiReceived">‚Ç±0</div>
                                        <div class="muted small">Help Received (30d)</div>
                                    </div>
                                </div>
                                <div class="progress mt-3">
                                    <div class="progress-bar" id="pbReceived" style="width:0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-3 col-md-6">
                            <div class="cardx p-3 h-100">
                                <div class="kpi">
                                    <i class="bi bi-arrow-up-circle fs-3 text-danger"></i>
                                    <div>
                                        <div class="stat" id="kpiProvided">‚Ç±0</div>
                                        <div class="muted small">Help Provided (30d)</div>
                                    </div>
                                </div>
                                <div class="progress mt-3">
                                    <div class="progress-bar" id="pbProvided" style="width:0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-lg-7">
                            <div class="cardx p-3 h-100">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="m-0">30-Day Activity</h6>
                                    <span class="badge-soft px-2 py-1 small">Demo</span>
                                </div>
                                <canvas id="chartActivity" height="120"></canvas>
                            </div>
                        </div>
                        <div class="col-lg-5">
                            <div class="cardx p-3 h-100">
                                <h6 class="mb-2">Category Split (demo)</h6>
                                <canvas id="chartSplit" height="120"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-12">
                            <div class="cardx p-3">
                                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                                    <div class="muted small">Quick actions</div>
                                    <div class="d-flex gap-2">
                                        <button class="btn btn-sm" data-bs-toggle="modal"
                                            data-bs-target="#modalNewRequest"><i
                                                class="bi bi-plus-circle me-1"></i>Create Request</button>
                                        <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal"
                                            data-bs-target="#modalSendHelp"><i
                                                class="bi bi-arrow-up-right-circle me-1"></i>Send Help</button>
                                        <a class="btn btn-sm btn-outline-light" href="./aboutus.html" target="_blank"><i
                                                class="bi bi-graph-up-arrow me-1"></i>About & Transparency</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- MY REQUESTS -->
                <section class="tab-pane fade" id="tab-requests" role="tabpanel" aria-labelledby="tablink-requests">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="m-0">My Requests</h5>
                        <div class="d-flex gap-2">
                            <input class="form-control form-control-sm" id="rqSearch" placeholder="Search‚Ä¶">
                            <select class="form-select form-select-sm" id="rqFilter">
                                <option value="">All</option>
                                <option>Pending</option>
                                <option>Verified</option>
                                <option>Fulfilled</option>
                            </select>
                            <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#modalNewRequest"><i
                                    class="bi bi-plus-circle me-1"></i>New Request</button>
                        </div>
                    </div>

                    <!-- kanban view -->
                    <div class="kanban mb-3">
                        <div class="kanban-col">
                            <h6><i class="bi bi-hourglass-split text-warning"></i> Pending</h6>
                            <div id="colPending"></div>
                        </div>
                        <div class="kanban-col">
                            <h6><i class="bi bi-check2-circle text-info"></i> Verified</h6>
                            <div id="colVerified"></div>
                        </div>
                        <div class="kanban-col">
                            <h6><i class="bi bi-gift text-success"></i> Fulfilled</h6>
                            <div id="colFulfilled"></div>
                        </div>
                    </div>

                    <!-- table view -->
                    <div class="cardx p-3">
                        <div class="table-responsive">
                            <table class="table table-dark table-striped table-hover align-middle">
                                <thead>
                                    <tr>
                                        <th>Ref</th>
                                        <th>Title</th>
                                        <th>Category</th>
                                        <th>Amount</th>
                                        <th>Status</th>
                                        <th>Created</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="tblRequests"></tbody>
                            </table>
                        </div>
                        <div class="small muted mt-2"><i class="bi bi-shield-exclamation me-1"></i>Remember to anonymize
                            sensitive docs before uploading proofs.</div>
                    </div>
                </section>

                <!-- PROVIDE HELP -->
                <section class="tab-pane fade" id="tab-provide" role="tabpanel" aria-labelledby="tablink-provide">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="m-0">Provide Help</h5>
                        <div class="d-flex gap-2">
                            <input type="search" class="form-control form-control-sm" id="phSearch"
                                placeholder="Search requests‚Ä¶" />
                            <select class="form-select form-select-sm" id="phFilter">
                                <option value="">All categories</option>
                                <option>Medical</option>
                                <option>Education</option>
                                <option>Housing</option>
                            </select>
                            <select class="form-select form-select-sm" id="phSort">
                                <option value="latest">Latest</option>
                                <option value="amount">Amount (High)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row g-3" id="provideGrid"></div>
                    <div class="d-flex justify-content-center gap-2 mt-3">
                        <button class="btn btn-outline-light btn-sm" id="phPrev">Prev</button>
                        <button class="btn btn-outline-light btn-sm" id="phNext">Next</button>
                    </div>
                    <div class="alert alert-note muted small mt-3">
                        <i class="bi bi-info-circle me-1"></i>Transfers are direct member-to-member. Keep receipts and
                        confirm delivery to protect everyone.
                    </div>
                </section>

                <!-- WALLET & TRANSACTIONS -->
                <section class="tab-pane fade" id="tab-wallet" role="tabpanel" aria-labelledby="tablink-wallet">
                    <div class="row g-3">
                        <div class="col-lg-4">
                            <div class="cardx p-3 h-100">
                                <h6>Wallet</h6>
                                <div class="display-6 fw-bold" id="walletBalance">‚Ç±0</div>
                                <div class="muted small">Available to send/withdraw</div>
                                <canvas id="chartWallet" height="80" class="mt-2"></canvas>
                                <div class="d-grid gap-2 mt-3">
                                    <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#modalAddFunds"><i
                                            class="bi bi-plus-circle me-1"></i>Add Funds</button>
                                    <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal"
                                        data-bs-target="#modalWithdraw"><i
                                            class="bi bi-box-arrow-down me-1"></i>Withdraw</button>
                                </div>
                                <hr>
                                <div class="muted small">Linked Bank</div>
                                <div id="bankInfo" class="small">Not set</div>
                                <button class="btn btn-sm btn-outline-light mt-2" data-bs-toggle="modal"
                                    data-bs-target="#modalBank"><i class="bi bi-bank me-1"></i>Update Bank
                                    Details</button>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="cardx p-3 h-100">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="m-0">Transactions</h6>
                                    <div class="d-flex gap-2">
                                        <input class="form-control form-control-sm" id="txSearch"
                                            placeholder="Search ref/type‚Ä¶">
                                        <button class="btn btn-sm btn-outline-light" id="btnExportCsv"><i
                                                class="bi bi-download me-1"></i>Export CSV</button>
                                    </div>
                                </div>
                                <div class="table-responsive mt-2">
                                    <table class="table table-dark table-striped table-hover align-middle">
                                        <thead>
                                            <tr>
                                                <th>Date</th>
                                                <th>Type</th>
                                                <th>Ref</th>
                                                <th>Amount</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tblTx"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- MESSAGES -->
                <section class="tab-pane fade" id="tab-messages" role="tabpanel" aria-labelledby="tablink-messages">
                    <div class="row g-3">
                        <div class="col-lg-4">
                            <div class="cardx p-3 h-100">
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <h6 class="m-0">Inbox</h6>
                                    <button class="btn btn-sm btn-outline-light" id="btnNewMessage"><i
                                            class="bi bi-pencil-square me-1"></i>New</button>
                                </div>
                                <div class="list-group list-group-flush" id="msgList"
                                    style="--bs-list-group-color:#cbd5e1;--bs-list-group-bg:transparent;--bs-list-group-border-color:rgba(255,255,255,.06)">
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-8">
                            <div class="cardx p-3 h-100">
                                <div class="d-flex align-items-center justify-content-between">
                                    <h6 class="m-0" id="msgTitle">Select a conversation</h6>
                                    <div class="muted small" id="msgMeta"></div>
                                </div>
                                <hr>
                                <div id="msgThread" class="d-flex flex-column gap-2"
                                    style="height:280px;overflow:auto;"></div>
                                <form class="mt-2 d-flex gap-2" id="formSendMessage">
                                    <input class="form-control" placeholder="Write a message‚Ä¶" id="msgInput" />
                                    <label class="btn btn-outline-light m-0">
                                        <i class="bi bi-paperclip"></i>
                                        <input type="file" id="msgAttach" hidden>
                                    </label>
                                    <button class="btn" type="submit"><i class="bi bi-send"></i></button>
                                </form>
                                <div class="small muted mt-2" id="msgAttachName"></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- REFERRALS (with Ranks & TPT School content) -->
                <section class="tab-pane fade" id="tab-referrals" role="tabpanel" aria-labelledby="tablink-referrals">
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div class="cardx p-3 h-100">
                                <h6>Invite friends</h6>
                                <div class="muted small">Share your link ‚Äî new members registering via your link appear
                                    below.</div>
                                <div class="input-group mt-2">
                                    <input class="form-control" id="inviteLink" readonly value="" />
                                    <button class="btn btn-outline-light" id="btnCopyInvite"><i
                                            class="bi bi-clipboard"></i></button>
                                </div>
                                <div class="d-flex gap-2 mt-2">
                                    <button class="btn btn-sm btn-outline-light"><i class="bi bi-facebook"></i></button>
                                    <button class="btn btn-sm btn-outline-light"><i
                                            class="bi bi-twitter-x"></i></button>
                                    <button class="btn btn-sm btn-outline-light"><i
                                            class="bi bi-link-45deg"></i></button>
                                </div>
                                <div class="alert alert-note small muted mt-3">
                                    <i class="bi bi-shield-exclamation me-1"></i>Invites help grow the community; they
                                    are <strong>not</strong> investment offers. Keep expectations grounded in reality.
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="cardx p-3 h-100">
                                <h6>Referral Stats (demo)</h6>
                                <div class="row g-2 text-center">
                                    <div class="col-4">
                                        <div class="display-6 fw-bold" id="refCount">0</div>
                                        <div class="muted small">Referrals</div>
                                    </div>
                                    <div class="col-4">
                                        <div class="display-6 fw-bold" id="refActive">0</div>
                                        <div class="muted small">Active</div>
                                    </div>
                                    <div class="col-4">
                                        <div class="display-6 fw-bold" id="refBonus">‚Ç±0</div>
                                        <div class="muted small">Recognitions</div>
                                    </div>
                                </div>
                                <canvas id="chartReferrals" height="110" class="mt-2"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3 mt-1">
                        <div class="col-lg-7">
                            <div class="cardx p-3 h-100">
                                <h6>Referral List</h6>
                                <div class="table-responsive">
                                    <table class="table table-dark table-striped table-hover align-middle">
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Email</th>
                                                <th>Joined</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="tblReferrals"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-5">
                            <div class="cardx p-3 h-100">
                                <h6>Ranks & TPT School</h6>
                                <p class="muted small mb-2">TPT School trains members to onboard others responsibly,
                                    explain policies clearly, and protect privacy.</p>
                                <ul class="muted small">
                                    <li><strong>Ranks (community recognition):</strong> 1‚Äì9 ‚Üí Leader ‚Ä¢ 10‚Äì99 ‚Üí 10+
                                        Leader ‚Ä¢ 100‚Äì999 ‚Üí 100+ Leader ‚Ä¢ 1K‚Äì9K ‚Üí 1K+ Leader ‚Ä¢ 10K‚Äì99K ‚Üí 10K+ ‚Ä¢ 100K‚Äì999K
                                        ‚Üí 100K+ ‚Ä¢ 1M+ ‚Üí 1M+ Leader.</li>
                                    <li><strong>Training:</strong> onboarding ethics, anti-fraud checks, documentation,
                                        and privacy-safe storytelling.</li>
                                </ul>
                                <div class="alert alert-note small muted">
                                    <i class="bi bi-info-circle me-1"></i>Community recognition is not financial
                                    compensation. No guaranteed returns, no pay-to-recruit. Always follow local laws.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="cardx p-3 mt-2">
                        <h6 class="mb-1">Historical/Legacy Materials (for context only)</h6>
                        <p class="muted small mb-2">Some legacy texts mention referral/leader ‚Äúbonuses‚Äù or internal
                            units (e.g., FELICIDAD). Treat these as <strong>illustrative</strong> and <strong>not
                                promises</strong>. Modern TPT prioritizes verified, need-based mutual aid, with
                            transparent summaries ‚Äî not financial products.</p>
                    </div>
                </section>

                <!-- VERIFICATION -->
                <section class="tab-pane fade" id="tab-verification" role="tabpanel"
                    aria-labelledby="tablink-verification">
                    <div class="row g-3">
                        <div class="col-lg-5">
                            <div class="cardx p-3 h-100">
                                <h6>Profile</h6>
                                <form id="formProfile" class="mt-2">
                                    <div class="mb-2"><label class="form-label small">Full name</label><input
                                            class="form-control" id="pName" required></div>
                                    <div class="mb-2"><label class="form-label small">Email</label><input
                                            class="form-control" id="pEmail" type="email" required></div>
                                    <div class="mb-2"><label class="form-label small">Phone</label><input
                                            class="form-control" id="pPhone"></div>
                                    <div class="mb-2"><label class="form-label small">City</label><input
                                            class="form-control" id="pCity"></div>
                                    <button class="btn btn-sm" type="submit">Save Profile</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-lg-7">
                            <div class="cardx p-3 h-100">
                                <h6>Verification (KYC)</h6>
                                <div class="muted small">Upload government ID and a selfie for manual review. We store
                                    only what‚Äôs necessary and purge on schedule.</div>
                                <form id="formKyc" class="row g-2 mt-2">
                                    <div class="col-md-6">
                                        <label class="form-label small">Government ID</label>
                                        <input class="form-control" type="file" id="kycId"
                                            accept="image/*,application/pdf">
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label small">Selfie</label>
                                        <input class="form-control" type="file" id="kycSelfie" accept="image/*">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label small">Notes (optional)</label>
                                        <textarea class="form-control" id="kycNotes" rows="2"></textarea>
                                    </div>
                                    <div class="col-12">
                                        <button class="btn btn-sm" type="submit"><i class="bi bi-upload me-1"></i>Submit
                                            for Review</button>
                                        <span class="badge-soft px-2 py-1 small ms-2" id="kycStatus">Not
                                            submitted</span>
                                    </div>
                                </form>
                                <hr>
                                <div class="muted small"><i class="bi bi-shield-lock me-1"></i>Tip: blur
                                    addresses/account numbers in public proofs. Only reviewers should see sensitive
                                    info.</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- TPT School -->

                <div class="tab-pane fade" id="tab-school" role="tabpanel" aria-labelledby="tablink-school"
                    tabindex="0">
                    <div class="d-flex align-items-center justify-content-between mb-3 topbar">
                        <div class="d-flex align-items-center gap-2">
                            <h5 class="m-0">TPT School ‚Äî Modules</h5>
                            <span class="chip" id="modProgress">0/6 complete</span>
                        </div>
                        <button class="btn btn-sm btn-ghost" data-bs-toggle="offcanvas" data-bs-target="#walletCanvas">
                            <i class="bi bi-wallet2 me-1"></i> Wallet
                        </button>
                    </div>

                    <div class="row g-3">
                        <!-- MAIN -->
                        <div class="col-lg-8">
                            <div class="panel p-3">
                                <div class="row g-2" id="modules"></div>
                            </div>
                        </div>

                        <!-- SIDE RAIL -->
                        <div class="col-lg-4">
                            <aside class="side-rail">
                                <div class="panel p-3 mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="m-0">Upload ‚ÄúLetter of Happiness‚Äù</h6><span
                                            class="chip">Optional</span>
                                    </div>
                                    <p class="small muted mb-2">
                                        Add a short video testimonial to help build trust. By uploading, you consent to
                                        its use per
                                        policy.
                                    </p>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-ghost" data-bs-toggle="modal"
                                            data-bs-target="#uploadModal">
                                            <i class="bi bi-camera-video me-1"></i>Upload Video
                                        </button>
                                    </div>
                                </div>

                                <div class="panel p-3 mb-3">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h6 class="m-0">Compliance Notes</h6><span class="chip">Read</span>
                                    </div>
                                    <ul class="small muted m-0">
                                        <li>No investments or guarantees ‚Äî donations only.</li>
                                        <li>Obey your country‚Äôs laws and platform rules.</li>
                                        <li>Transfers must be confirmed with receipts.</li>
                                    </ul>
                                </div>

                                <div class="panel p-3">
                                    <h6 class="mb-2">Tips</h6>
                                    <div id="tips" class="small muted"></div>
                                </div>
                            </aside>
                        </div>
                    </div>

                    <div class="footer small muted mt-4 py-2">
                        <span>¬© <span id="year"></span> TPT M√©xico ‚Äî Member Portal</span>
                    </div>
                </div>

                <!-- SETTINGS -->
                <section class="tab-pane fade" id="tab-settings" role="tabpanel" aria-labelledby="tablink-settings">
                    <div class="row g-3">
                        <div class="col-lg-6">
                            <div class="cardx p-3 h-100">
                                <h6>Preferences</h6>
                                <form id="formPrefs" class="mt-2">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="prefEmail" checked>
                                        <label class="form-check-label" for="prefEmail">Email notifications</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="prefSms">
                                        <label class="form-check-label" for="prefSms">SMS notifications</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="prefAnon" checked>
                                        <label class="form-check-label" for="prefAnon">Privacy: show as
                                            anonymous</label>
                                    </div>
                                    <div class="mt-2">
                                        <label class="form-label small">Language</label>
                                        <select class="form-select" id="prefLang">
                                            <option>English</option>
                                            <option selected>Espa√±ol</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-sm mt-2" type="submit">Save Preferences</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-lg-6">
                            <div class="cardx p-3 h-100">
                                <h6>Security</h6>
                                <form id="formSecurity" class="mt-2">
                                    <div class="mb-2"><label class="form-label small">Current password</label><input
                                            class="form-control" type="password" id="secCur"></div>
                                    <div class="mb-2"><label class="form-label small">New password</label><input
                                            class="form-control" type="password" id="secNew"></div>
                                    <div class="mb-2"><label class="form-label small">Confirm new password</label><input
                                            class="form-control" type="password" id="secNew2"></div>
                                    <div class="form-check form-switch mt-2">
                                        <input class="form-check-input" type="checkbox" id="sec2fa">
                                        <label class="form-check-label" for="sec2fa">Enable 2-factor
                                            authentication</label>
                                    </div>
                                    <button class="btn btn-sm mt-2" type="submit">Update Security</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </section>

            <section class="tab-pane fade" id="tab-policies" role="tabpanel" aria-labelledby="tablink-policies">
                <div class="policy-wrap">
                    <!-- Sidebar TOC -->
                    <aside class="policy-toc">
                        <div class="policy-card p-3">
                            <div class="d-flex align-items-center gap-2 mb-2">
                                <i class="bi bi-shield-check fs-5"></i>
                                <h6 class="mb-0">Policies & Safeguards</h6>
                            </div>
                            <div class="policy-meta small muted mb-2">
                                <span class="badge policy-badge">V1.4</span>
                                <span>Last updated: <span id="polLastUpdated">‚Äî</span></span>
                            </div>
                            <nav class="nav flex-column gap-1 policy-nav" id="policyNav">
                                <a class="nav-link" href="#pol-overview"><i class="bi bi-info-circle"></i> Overview</a>
                                <a class="nav-link" href="#pol-eligibility"><i class="bi bi-person-check"></i> Eligibility</a>
                                <a class="nav-link" href="#pol-conduct"><i class="bi bi-emoji-smile"></i> Code of Conduct</a>
                                <a class="nav-link" href="#pol-contrib"><i class="bi bi-gift"></i> Contributions & Recognition</a>
                                <a class="nav-link" href="#pol-privacy"><i class="bi bi-incognito"></i> Privacy & Data</a>
                                <a class="nav-link" href="#pol-risk"><i class="bi bi-exclamation-octagon"></i> Risks & Law</a>
                                <a class="nav-link" href="#pol-reporting"><i class="bi bi-flag"></i> Reporting & Disputes</a>
                                <a class="nav-link" href="#pol-testimonials"><i class="bi bi-chat-quote"></i> Testimonials</a>
                            </nav>
            
                            <div class="mt-3">
                                <label class="d-flex align-items-center gap-2 small">
                                    <input id="polAccept" type="checkbox" class="form-check-input" />
                                    I‚Äôve read & agree
                                </label>
                                <div class="d-grid gap-2 mt-2">
                                    <button id="polPrintBtn" class="btn btn-ghost btn-sm"><i class="bi bi-printer me-1"></i>Print /
                                        Save PDF</button>
                                    <button id="polContinueBtn" class="btn btn-sm"><i class="bi bi-check2-circle me-1"></i>Accept &
                                        Continue</button>
                                </div>
                            </div>
                        </div>
            
                        <div class="policy-tip policy-card p-3 mt-2">
                            <div class="d-flex gap-2">
                                <i class="bi bi-lightbulb"></i>
                                <div class="small">
                                    Tip: Use the <em>Accept & Continue</em> button once. We‚Äôll remember it on this device.
                                </div>
                            </div>
                        </div>
                    </aside>
            
                    <!-- Main content -->
                    <main class="policy-content" data-bs-spy="scroll" data-bs-target="#policyNav" data-bs-smooth-scroll="true"
                        tabindex="0">
                        <!-- Hero notice -->
                        <div class="policy-hero policy-card p-4 mb-3">
                            <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
                                <h4 class="mb-0">Read Before You Participate</h4>
                                <div class="d-flex align-items-center gap-2 small">
                                    <span class="badge policy-badge">Mutual Aid</span>
                                    <span class="badge policy-badge">No Investment</span>
                                    <span class="badge policy-badge">Transparency</span>
                                </div>
                            </div>
                            <p class="muted mt-2 mb-0">
                                TPT is a voluntary mutual-aid community. Contributions are <strong>gifts</strong> to meet verified
                                needs.
                                <u>Not</u> a bank, lender, or investment. <u>No guaranteed returns.</u> Always follow your local
                                laws.
                            </p>
                        </div>
            
                        <!-- Sections -->
                        <section id="pol-overview" class="policy-card p-3 mb-3">
                            <h5 class="policy-h">1) Overview & Principles</h5>
                            <p class="muted">
                                We coordinate dignity-first help where access to resources is uneven. We value equality, sincerity,
                                transparency,
                                accountability, and recognition of real effort. TPT does <em>not</em> sell money or promise profits.
                            </p>
                            <div class="policy-callout">
                                <i class="bi bi-cash-coin"></i>
                                <div>
                                    <strong>On ‚Äúmoney‚Äù.</strong> Our materials describe scarcity as ‚Äúshackles.‚Äù Our response is
                                    mutual aid with
                                    clear rules‚Äî<em>not</em> profit schemes.
                                </div>
                            </div>
                            <ul class="small muted mb-0">
                                <li><strong>2016:</strong> Early grassroots effort; later reorganized.</li>
                                <li><strong>2019‚Äì2024:</strong> Online relaunch; cross-region participation; transparency focus.
                                </li>
                            </ul>
                        </section>
            
                        <section id="pol-eligibility" class="policy-card p-3 mb-3">
                            <h5 class="policy-h">2) Eligibility & Accounts</h5>
                            <ul class="policy-list">
                                <li>Adults only; real information when verification is required.</li>
                                <li>One account per person; no shared accounts or recycled IDs.</li>
                                <li>Referrals allowed within published caps and anti-abuse rules.</li>
                                <li>Comply with your local laws and platform policies.</li>
                            </ul>
                        </section>
            
                        <section id="pol-conduct" class="policy-card p-3 mb-3">
                            <h5 class="policy-h">3) Code of Conduct</h5>
                            <ul class="policy-list">
                                <li><strong>Respect & safety:</strong> no harassment, hate, threats, fraud, or scams.</li>
                                <li><strong>Accuracy:</strong> represent needs truthfully; share proofs privately; get consent
                                    before publication.</li>
                                <li><strong>Timeliness:</strong> provide pledged help within 72 hours.</li>
                                <li><strong>No returns:</strong> never promise profits, ‚Äúdoublers,‚Äù or guaranteed bonuses.</li>
                                <li><strong>Transparency:</strong> keep receipts; cooperate with checks to prevent misuse.</li>
                            </ul>
                        </section>
            
                        <section id="pol-contrib" class="policy-card p-3 mb-3">
                            <h5 class="policy-h">4) Contributions, Recognition & Stability</h5>
                            <div class="policy-callout warn">
                                <i class="bi bi-exclamation-octagon"></i>
                                <div>
                                    Mentions of <strong>FELICIDAD</strong> or ‚Äúbonuses‚Äù are symbolic community recognition.
                                    They are <strong>not</strong> guarantees, not currency, and have no cash-out value.
                                </div>
                            </div>
                            <ul class="policy-list">
                                <li><strong>Gifts only:</strong> contributions are voluntary and final.</li>
                                <li><strong>Recognition units:</strong> symbolic acknowledgments; no resale or expectation of
                                    return.</li>
                                <li><strong>Healthy system:</strong> diversify help; avoid over-promising; invite responsibly.</li>
                            </ul>
                        </section>
            
                        <section id="pol-privacy" class="policy-card p-3 mb-3">
                            <h5 class="policy-h">5) Privacy, Data & Media</h5>
                            <ul class="policy-list">
                                <li>Use privacy-safe proofs (blur/redact) when possible.</li>
                                <li>Obtain explicit consent before publishing stories, images, or receipts.</li>
                                <li>Collect the minimum data needed for verification and anti-abuse.</li>
                                <li>We honor reasonable takedown requests for personal content shared on TPT channels.</li>
                            </ul>
                        </section>
            
                        <section id="pol-risk" class="policy-card p-3 mb-3">
                            <h5 class="policy-h">6) Risks & Legal Notices</h5>
                            <p class="muted">
                                Participation carries risk. This is not an investment; there are no guaranteed returns. Follow your
                                country‚Äôs laws
                                (including tax rules) and platform policies.
                            </p>
                            <div class="policy-tip policy-card p-3 mb-0">
                                <div class="d-flex gap-2">
                                    <i class="bi bi-life-preserver"></i>
                                    <div class="small">Start small. Read all rules. Ask in <strong>Messages</strong> or
                                        <strong>Support</strong> if unsure.</div>
                                </div>
                            </div>
                        </section>
            
                        <section id="pol-reporting" class="policy-card p-3 mb-3">
                            <h5 class="policy-h">7) Reporting & Dispute Resolution</h5>
                            <ol class="policy-steps">
                                <li>Contact the other party first (if safe).</li>
                                <li>Open a <strong>Support</strong> ticket with receipts/screenshots.</li>
                                <li>Compliance review may warn, pause, or remove accounts to prevent abuse.</li>
                            </ol>
                            <div class="small muted">We may cooperate with lawful requests from authorities to prevent fraud or
                                harm.</div>
                        </section>
            
                        <section id="pol-testimonials" class="policy-card p-3">
                            <h5 class="policy-h">8) Community Testimonials (Privacy-Safe)</h5>
                            <blockquote class="policy-quote">
                                ‚ÄúI‚Äôm a construction worker‚Ä¶ thanks to TPT I can provide for my family.‚Äù ‚Äî Marcus M.
                            </blockquote>
                            <blockquote class="policy-quote">
                                ‚ÄúI‚Äôm tired of being paid peanuts‚Ä¶ I want to change the world.‚Äù ‚Äî Lucas H., Jiquipilco
                            </blockquote>
                            <blockquote class="policy-quote mb-0">
                                ‚ÄúMy father advised me to join, and he was right.‚Äù ‚Äî Anonymous
                            </blockquote>
                        </section>
            
                        <!-- Footer line -->
                        <div class="d-flex justify-content-between align-items-center mt-3 small muted">
                            <span>Questions? Visit <a href="#" id="polGoSupport">Support</a> or send a message.</span>
                            <span>&copy; <span id="polYear">‚Äî</span> TPT Community</span>
                        </div>
                    </main>
                </div>
            </section>

                <!-- SUPPORT -->
                <section class="tab-pane fade" id="tab-support" role="tabpanel" aria-labelledby="tablink-support">
                    <div class="cardx sup-hero p-3 mb-3">
                        <div class="d-flex flex-wrap align-items-center gap-3">
                            <div class="d-flex align-items-center gap-2">
                                <span class="sup-dot"></span>
                                <div>
                                    <div class="small muted">Support Status</div>
                                    <div class="fw-semibold">Online ‚Ä¢ Normal load</div>
                                </div>
                            </div>
                            <div class="sup-pill">Avg. first response <strong>~2‚Äì6 hours</strong></div>
                            <div class="sup-pill">Uptime <strong>99.94%</strong></div>
                            <div class="ms-auto">
                                <button class="btn btn-ghost btn-sm" id="supCopyEmail"><i
                                        class="bi bi-envelope me-1"></i>support@tpt.example</button>
                            </div>
                        </div>
                    </div>
                
                    <div class="row g-3">
                        <!-- Contact Support -->
                        <div class="col-lg-6">
                            <div class="cardx p-3 h-100">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Contact Support</h6>
                                    <div class="dropdown">
                                        <button class="btn btn-ghost btn-sm dropdown-toggle" data-bs-toggle="dropdown"><i
                                                class="bi bi-lightning-charge me-1"></i>Quick templates</button>
                                        <div class="dropdown-menu dropdown-menu-end sup-quick">
                                            <a class="dropdown-item" data-sup-template="verification"><i
                                                    class="bi bi-shield-check me-2"></i>Verification issue</a>
                                            <a class="dropdown-item" data-sup-template="payment"><i
                                                    class="bi bi-credit-card me-2"></i>Payment/receipt help</a>
                                            <a class="dropdown-item" data-sup-template="abuse"><i class="bi bi-flag me-2"></i>Abuse
                                                report</a>
                                            <a class="dropdown-item" data-sup-template="general"><i
                                                    class="bi bi-chat-dots me-2"></i>General question</a>
                                        </div>
                                    </div>
                                </div>
                
                                <form id="formSupport" class="mt-3">
                                    <div class="row g-2">
                                        <div class="col-12">
                                            <label class="form-label small">Your email</label>
                                            <input class="form-control" id="supEmail" type="email" placeholder="you@example.com"
                                                required>
                                        </div>
                                        <div class="col-8">
                                            <label class="form-label small">Subject</label>
                                            <input class="form-control" id="supSub" maxlength="120" required>
                                        </div>
                                        <div class="col-4">
                                            <label class="form-label small">Category</label>
                                            <select class="form-select" id="supCat">
                                                <option>General</option>
                                                <option>Verification</option>
                                                <option>Payments</option>
                                                <option>Abuse/Report</option>
                                                <option>Account</option>
                                                <option>Technical</option>
                                            </select>
                                        </div>
                                    </div>
                
                                    <div class="row g-2 mt-1">
                                        <div class="col-6">
                                            <label class="form-label small">Priority</label>
                                            <select class="form-select" id="supPri">
                                                <option value="Normal" selected>Normal</option>
                                                <option value="High">High</option>
                                                <option value="Urgent">Urgent</option>
                                            </select>
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label small">Attachment (optional)</label>
                                            <input class="form-control" type="file" id="supFile"
                                                accept=".png,.jpg,.jpeg,.pdf,.doc,.docx,.txt">
                                            <div class="small muted mt-1" id="supFileName"></div>
                                        </div>
                                    </div>
                
                                    <div class="mt-2">
                                        <label class="form-label small d-flex justify-content-between">
                                            <span>Message</span>
                                            <span class="small muted"><span id="supCount">0</span>/1000</span>
                                        </label>
                                        <textarea class="form-control" id="supMsg" rows="5" maxlength="1000" required></textarea>
                                    </div>
                
                                    <div class="d-flex gap-2 mt-3">
                                        <button class="btn btn-sm" type="submit" id="supSendBtn">
                                            <i class="bi bi-envelope me-1"></i><span>Send</span>
                                        </button>
                                        <button class="btn btn-ghost btn-sm" type="button" id="supResetDraft"><i
                                                class="bi bi-eraser me-1"></i>Clear</button>
                                    </div>
                
                                    <!-- Success mini-receipt -->
                                    <div class="alert alert-note mt-3 d-none" id="supSuccess">
                                        <i class="bi bi-check2-circle me-1"></i>
                                        Ticket created: <strong id="supTicketId"></strong>. We emailed you a confirmation (demo).
                                    </div>
                                </form>
                            </div>
                        </div>
                
                        <!-- Help Center / FAQ -->
                        <div class="col-lg-6">
                            <div class="cardx p-3 h-100">
                                <div class="d-flex align-items-center gap-2 mb-2">
                                    <h6 class="mb-0">Help Center</h6>
                                    <span class="chip">FAQ</span>
                                    <div class="ms-auto" style="width: 220px;">
                                        <div class="input-group input-group-sm">
                                            <span class="input-group-text bg-transparent text-light border-0"><i
                                                    class="bi bi-search"></i></span>
                                            <input class="form-control" id="faqSearch" placeholder="Search FAQ‚Ä¶">
                                        </div>
                                    </div>
                                </div>
                
                                <div class="accordion accordion-flush sup-faq" id="helpFaq">
                                    <!-- Each .accordion-item should have a data-tags attribute for search -->
                                    <div class="accordion-item" data-tags="investment return profit guarantee">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#hf1">
                                                Is this an investment?
                                            </button>
                                        </h2>
                                        <div id="hf1" class="accordion-collapse collapse">
                                            <div class="accordion-body muted small">
                                                No ‚Äî contributions are gifts to meet verified needs. There are no guaranteed returns.
                                            </div>
                                        </div>
                                    </div>
                
                                    <div class="accordion-item" data-tags="verify documents criteria review">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#hf2">
                                                How are requests verified?
                                            </button>
                                        </h2>
                                        <div id="hf2" class="accordion-collapse collapse">
                                            <div class="accordion-body muted small">
                                                Applicants submit documents; reviewers validate details according to public criteria.
                                            </div>
                                        </div>
                                    </div>
                
                                    <div class="accordion-item" data-tags="fees charges processor summary">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#hf3">
                                                Are there fees?
                                            </button>
                                        </h2>
                                        <div id="hf3" class="accordion-collapse collapse">
                                            <div class="accordion-body muted small">
                                                Only payment-processor and small compliance costs. We publish summaries.
                                            </div>
                                        </div>
                                    </div>
                
                                    <div class="accordion-item" data-tags="account login password reset 2fa">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#hf4">
                                                I can‚Äôt log in ‚Äî what should I try?
                                            </button>
                                        </h2>
                                        <div id="hf4" class="accordion-collapse collapse">
                                            <div class="accordion-body muted small">
                                                Try password reset, ensure 2FA code time is correct, and check spam for emails. If still
                                                blocked, contact Support with device details.
                                            </div>
                                        </div>
                                    </div>
                
                                    <div class="accordion-item" data-tags="payment receipt proof refund dispute">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" data-bs-toggle="collapse" data-bs-target="#hf5">
                                                Payment sent but not reflected ‚Äî what now?
                                            </button>
                                        </h2>
                                        <div id="hf5" class="accordion-collapse collapse">
                                            <div class="accordion-body muted small">
                                                Upload a receipt and the reference ID. Processing can take up to 24h depending on the
                                                network/processor.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <!-- Still need help -->
                                <div class="sup-helpmore cardx p-2 mt-3">
                                    <div class="d-flex flex-wrap align-items-center gap-2">
                                        <i class="bi bi-headset fs-5"></i>
                                        <div class="small">
                                            Still need help? Open a ticket above or message us via <a href="#"
                                                id="openMessagesFromSupport">Messages</a>.
                                        </div>
                                        <div class="ms-auto">
                                            <span class="sup-pill"><i class="bi bi-clock me-1"></i>7am‚Äì9pm (your time)</span>
                                        </div>
                                    </div>
                                </div>
                
                            </div>
                        </div>
                    </div>
                </section>


                <!-- PROFILE TAB (drop-in) -->
                <div class="tab-pane fade" id="tab-profile" role="tabpanel" aria-labelledby="tablink-profile"
                    tabindex="0">
                    <!-- Topbar -->
                    <div class="d-flex align-items-center justify-content-between mb-3 topbar relative"
                        style="position:relative; overflow:visible; z-index:1;">

                        <div>
                            <h5 class="m-0">My Profile</h5>
                            <small class="">Manage your personal info, security and preferences</small>
                        </div>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-ghost" id="btnEditProfile"><i
                                    class="bi bi-pencil-square me-1"></i>Edit</button>
                            <button class="btn btn-sm btn-secondary d-none" id="btnCancelEdit"><i
                                    class="bi bi-x-circle me-1"></i>Cancel</button>
                            <button class="btn btn-sm btn-primary d-none" id="btnSaveProfile"><i
                                    class="bi bi-check2-circle me-1"></i>Save</button>
                        </div>
                    </div>

                    <div class="row g-3">
                        <!-- LEFT: Avatar + Personal Info -->
                        <div class="col-lg-8">
                            <div class="panel p-3">
                                <div class="row g-3 align-items-center">
                                    <div class="col-md-3 text-center">
                                        <label for="avatarInput" class="d-inline-block position-relative">
                                            <img id="avatarPreview"
                                                src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=240&auto=format&fit=crop"
                                                class="rounded-circle mb-2 object-fit-cover" width="120" height="120"
                                                alt="Avatar">
                                            <input id="avatarInput" type="file" accept="image/*" class="visually-hidden"
                                                disabled>
                                            <span
                                                class="badge rounded-pill bg-dark-subtle text-body-secondary small position-absolute bottom-0 start-50 translate-middle-x">
                                                <i class="bi bi-camera"></i> Change
                                            </span>
                                        </label>
                                        <div class="small text-secondary">PNG, JPG up to 2MB</div>
                                    </div>

                                    <div class="col-md-9">
                                        <form id="profileForm" novalidate>
                                            <div class="row g-3">
                                                <div class="col-md-6">
                                                    <label class="form-label small">First name</label>
                                                    <input name="firstName" type="text"
                                                        class="form-control form-control-sm" value="Friend" disabled
                                                        required>
                                                    <div class="invalid-feedback">Please enter your first name.</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label small">Last name</label>
                                                    <input name="lastName" type="text"
                                                        class="form-control form-control-sm" value="User" disabled
                                                        required>
                                                    <div class="invalid-feedback">Please enter your last name.</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label small">Email</label>
                                                    <input name="email" type="email"
                                                        class="form-control form-control-sm" value="friend@example.com"
                                                        disabled required>
                                                    <div class="invalid-feedback">Enter a valid email.</div>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label small">Phone</label>
                                                    <input name="phone" type="tel" class="form-control form-control-sm"
                                                        value="+234 800 000 0000" disabled>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label small">Country</label>
                                                    <select name="country" class="form-select form-select-sm" disabled>
                                                        <option>Nigeria</option>
                                                        <option>Ghana</option>
                                                        <option>Kenya</option>
                                                        <option>South Africa</option>
                                                        <option>Other</option>
                                                    </select>
                                                </div>
                                                <div class="col-md-6">
                                                    <label class="form-label small">City</label>
                                                    <input name="city" type="text" class="form-control form-control-sm"
                                                        value="Lagos" disabled>
                                                </div>
                                                <div class="col-12">
                                                    <label class="form-label small">Bio</label>
                                                    <textarea name="bio" rows="3" class="form-control form-control-sm"
                                                        placeholder="Tell people a bit about you‚Ä¶"
                                                        disabled>Member at TPT M√©xico</textarea>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <hr>
                                <!-- Preferences -->
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label small">Language</label>
                                        <select name="lang" class="form-select form-select-sm" form="profileForm"
                                            disabled>
                                            <option>English</option>
                                            <option>Espa√±ol</option>
                                            <option>Fran√ßais</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small">Time zone</label>
                                        <select name="tz" class="form-select form-select-sm" form="profileForm"
                                            disabled>
                                            <option>Africa/Lagos (GMT+1)</option>
                                            <option>Africa/Nairobi (GMT+3)</option>
                                            <option>UTC</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label small">Theme</label>
                                        <select name="theme" class="form-select form-select-sm" form="profileForm"
                                            disabled>
                                            <option>System</option>
                                            <option>Dark</option>
                                            <option>Light</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- RIGHT: Account & Security / Activity -->
                        <div class="col-lg-4">
                            <!-- Account & Security -->
                            <div class="panel p-3 mb-3">
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <h6 class="m-0">Account & Security</h6>
                                </div>
                                <div class="vstack gap-2">
                                    <button class="btn btn-sm btn-outline-light w-100" id="btnChangePassword">
                                        <i class="bi bi-shield-lock me-2"></i>Change Password
                                    </button>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch" id="switch2FA"
                                            disabled>
                                        <label class="form-check-label small" for="switch2FA">Two-factor
                                            authentication</label>
                                    </div>
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" role="switch"
                                            id="switchEmailNotif" disabled checked>
                                        <label class="form-check-label small" for="switchEmailNotif">Email
                                            notifications</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="panel p-3">
                                <div class="d-flex align-items-center justify-content-between mb-2">
                                    <h6 class="m-0">Recent Activity</h6>
                                    <span class="chip">Last 7 days</span>
                                </div>
                                <ul class="list-unstyled m-0 small">
                                    <li class="d-flex align-items-start gap-2 py-1">
                                        <i class="bi bi-box-arrow-in-right mt-1"></i>
                                        <div>Signed in ‚Äî Lagos, NG <div class="text-secondary">Today, 12:02</div>
                                        </div>
                                    </li>
                                    <li class="d-flex align-items-start gap-2 py-1">
                                        <i class="bi bi-pencil-square mt-1"></i>
                                        <div>Updated profile <div class="text-secondary">Yesterday</div>
                                        </div>
                                    </li>
                                    <li class="d-flex align-items-start gap-2 py-1">
                                        <i class="bi bi-envelope mt-1"></i>
                                        <div>Enabled email notifications <div class="text-secondary">3 days ago</div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Toast -->
                    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080;">
                        <div id="profileToast" class="toast align-items-center text-bg-dark border-0" role="status"
                            aria-live="polite" aria-atomic="true">
                            <div class="d-flex">
                                <div class="toast-body">
                                    <i class="bi bi-check2-circle me-2"></i>Profile updated successfully.
                                </div>
                                <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                    data-bs-dismiss="toast" aria-label="Close"></button>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </main>
    </div>

    <!-- MODALS -->
    <div class="modal fade" id="modalNewRequest" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content"
                style="background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.10)">
                <div class="modal-header border-0">
                    <h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>New Request</h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formNewRequest" class="row g-2">
                        <div class="col-md-6"><label class="form-label small">Title</label><input class="form-control"
                                id="rqTitle" required></div>
                        <div class="col-md-3"><label class="form-label small">Category</label>
                            <select class="form-select" id="rqCat">
                                <option>Medical</option>
                                <option>Education</option>
                                <option>Housing</option>
                            </select>
                        </div>
                        <div class="col-md-3"><label class="form-label small">Amount (MXN)</label><input type="number"
                                class="form-control" id="rqAmt" required min="1"></div>
                        <div class="col-12"><label class="form-label small">Reason / Description</label><textarea
                                class="form-control" id="rqDesc" rows="3" required></textarea></div>
                        <div class="col-12"><label class="form-label small">Bank details</label><textarea
                                class="form-control" id="rqBank" rows="2" required></textarea></div>
                        <div class="col-12 d-flex gap-2 mt-1">
                            <button class="btn" type="submit">Publish</button>
                            <button class="btn btn-outline-light" type="button" data-bs-dismiss="modal">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalSendHelp" tabindex="-1">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content"
                style="background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.10)">
                <div class="modal-header border-0">
                    <h5 class="modal-title"><i class="bi bi-arrow-up-right-circle me-2"></i>Send Help</h5>
                    <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formSendHelp">
                        <div class="mb-2"><label class="form-label small">Request Ref</label><input class="form-control"
                                id="shRef" required></div>
                        <div class="mb-2"><label class="form-label small">Amount (MXN)</label><input type="number"
                                class="form-control" id="shAmt" required min="1"></div>
                        <div class="mb-2"><label class="form-label small">Note (optional)</label><textarea
                                class="form-control" id="shNote" rows="2"></textarea></div>
                        <div class="d-flex gap-2 mt-2">
                            <button class="btn" type="submit">Confirm Transfer</button>
                            <button class="btn btn-outline-light" data-bs-dismiss="modal" type="button">Cancel</button>
                        </div>
                        <div class="small muted mt-2"><i class="bi bi-shield-exclamation me-1"></i>Transfers are direct
                            member-to-member. Keep receipts for verification.</div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Wallet modals -->
    <div class="modal fade" id="modalAddFunds" tabindex="-1">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content"
                style="background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.10)">
                <div class="modal-header border-0">
                    <h6 class="modal-title">Add Funds</h6><button class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formAddFunds">
                        <div class="mb-2"><label class="form-label small">Amount</label><input type="number"
                                class="form-control" id="afAmt" min="1" required></div>
                        <div class="mb-2"><label class="form-label small">Method</label>
                            <select class="form-select" id="afMethod">
                                <option>Bank Transfer</option>
                                <option>Card</option>
                                <option>Bitcoin</option>
                            </select>
                        </div>
                        <button class="btn btn-sm" type="submit">Add</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalWithdraw" tabindex="-1">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content"
                style="background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.10)">
                <div class="modal-header border-0">
                    <h6 class="modal-title">Withdraw</h6><button class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formWithdraw">
                        <div class="mb-2"><label class="form-label small">Amount</label><input type="number"
                                class="form-control" id="wdAmt" min="1" required></div>
                        <div class="mb-2 small muted">Funds are sent to your linked bank account.</div>
                        <button class="btn btn-sm" type="submit">Withdraw</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modalBank" tabindex="-1">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content"
                style="background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)); border:1px solid rgba(255,255,255,.10)">
                <div class="modal-header border-0">
                    <h6 class="modal-title">Bank Details</h6><button class="btn-close btn-close-white"
                        data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formBank">
                        <div class="mb-2"><label class="form-label small">Account name</label><input
                                class="form-control" id="bkName" required></div>
                        <div class="mb-2"><label class="form-label small">CLABE / IBAN</label><input
                                class="form-control" id="bkNumber" required></div>
                        <div class="mb-2"><label class="form-label small">Bank</label><input class="form-control"
                                id="bkBank" required></div>
                        <button class="btn btn-sm" type="submit">Save Bank</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Wallet Offcanvas -->
    <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="walletCanvas">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title"><i class="bi bi-wallet2 me-2"></i>Wallet ‚Äî FELICIDAD</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"></button>
        </div>
        <div class="offcanvas-body">
            <div class="panel p-3 mb-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="small muted text-uppercase">Current Balance</div><span class="chip">Demo</span>
                </div>
                <div class="fw-bold" id="wBalance">FEL 0</div>
                <div class="d-flex gap-2 mt-2">
                    <button class="btn btn-sm" id="convertCash">Convert to MXN</button>
                    <button class="btn btn-ghost btn-sm" id="addFeliz">Add Demo FEL</button>
                </div>
            </div>
            <div class="panel p-3">
                <h6>Wallet History</h6>
                <ul class="list-group list-group-flush small" id="walletList"></ul>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title"><i class="bi bi-camera-video me-2"></i>Upload Letter of Happiness</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="uploadForm" class="needs-validation" novalidate>
                        <div class="mb-3">
                            <label class="form-label">Video File</label>
                            <input id="upFile" type="file" class="form-control" accept="video/*" required>
                            <div class="invalid-feedback">Select a file</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Caption (optional)</label>
                            <input id="upCaption" class="form-control" placeholder="Short description">
                        </div>
                        <div class="d-flex justify-content-end gap-2">
                            <button class="btn btn-ghost" type="button" data-bs-dismiss="modal">Cancel</button>
                            <button class="btn" type="submit">Upload</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm Logout -->
    <div class="modal fade" id="modalConfirmLogout" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: var(--card); color: var(--ink);">
                <div class="modal-header">
                    <h6 class="modal-title"><i class="bi bi-shield-lock me-2"></i>Confirm logout</h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">Are you sure you want to log out?</div>
                <div class="modal-footer">
                    <button class="btn btn-sm btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button class="btn btn-sm btn-danger" id="confirmLogout">Yes, log me out</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logged Out -->
    <div class="modal fade" id="modalLoggedOut" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background: var(--card); color: var(--ink);">
                <div class="modal-header">
                    <h6 class="modal-title"><i class="bi bi-door-closed me-2"></i>You‚Äôre logged out</h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">Choose what you‚Äôd like to do next.</div>
                <div class="modal-footer d-flex justify-content-between">
                    <a href="login.html" class="btn btn-sm btn-primary"><i class="bi bi-box-arrow-in-right me-1"></i>Log
                        back in</a>
                    <a href="index.html" class="btn btn-sm btn-outline-light"><i class="bi bi-house-door me-1"></i>Home
                        page</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login -->
    <div class="modal fade" id="modalAdminLogin" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <form class="modal-content" id="formAdminLogin" style="background: var(--card); color: var(--ink);">
                <div class="modal-header">
                    <h6 class="modal-title"><i class="bi bi-person-lock me-2"></i>Admin Login</h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2">
                        <label class="form-label small">Admin Email</label>
                        <input type="email" class="form-control" id="adminEmail" placeholder="admin@example.com"
                            required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">Password</label>
                        <input type="password" class="form-control" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">Remember me</label>
                        </div>
                        <a href="#" data-bs-toggle="modal" data-bs-target="#forgotModal" data-bs-dismiss="modal"
                            style="color:#cfe6ff;">
                            Forgot password?
                        </a>

                    </div>
                </div>
                <div class="modal-footer d-flex align-items-center justify-content-between">
                    <button class="btn btn-sm btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>

                    <!-- add the slash link to open signup -->
                    <span class="small me-auto ms-3">/
                        <a href="#" id="linkOpenAdminSignup" class="text-decoration-none" style="color:#cfe6ff">Sign up
                            as admin</a>
                    </span>

                    <button class="btn btn-sm btn-primary" type="submit">
                        <i class="bi bi-box-arrow-in-right me-1"></i>Login
                    </button>
                </div>

            </form>
        </div>
    </div>

    <!-- Admin Sign-Up -->
    <div class="modal fade" id="modalAdminSignup" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <form class="modal-content" id="formAdminSignup" style="background: var(--card); color: var(--ink);">
                <div class="modal-header">
                    <h6 class="modal-title"><i class="bi bi-shield-plus me-2"></i>Admin Sign-Up</h6>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-2">
                        <label class="form-label small">Full name</label>
                        <input type="text" class="form-control" id="suName" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">Admin Email</label>
                        <input type="email" class="form-control" id="suEmail" placeholder="admin@example.com" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">Password</label>
                        <input type="password" class="form-control" id="suPassword" minlength="6" required>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">Reason / Role Scope</label>
                        <textarea class="form-control" id="suReason" rows="2"
                            placeholder="Why do you need admin access?" required></textarea>
                    </div>
                    <div class="mb-2">
                        <label class="form-label small">Invitation / Approval Code (optional)</label>
                        <input type="text" class="form-control" id="suInvite" placeholder="e.g. INVITE-ADMIN">
                    </div>
                    <div class="small muted">
                        Your request may require approval by the Major Admin. You‚Äôll be redirected automatically once
                        approved.
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-sm btn-secondary" data-bs-dismiss="modal" type="button">Cancel</button>
                    <button class="btn btn-sm btn-primary" type="submit">
                        <i class="bi bi-person-check me-1"></i>Request Access
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Forgot Password MODAL -->
    <div class="modal fade auth-modal" id="forgotModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0 d-flex justify-content-between align-items-center">
                    <h5 class="modal-title">
                        <i class="bi bi-envelope-paper me-2"></i>Forgot password
                    </h5>
                    <button type="button" class="btn btn-outline-light btn-sm rounded-circle" data-bs-dismiss="modal"
                        aria-label="Close">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="small muted mb-3">Enter the email linked to your account and we‚Äôll send you a reset
                        link.
                    </div>

                    <!-- alerts -->
                    <div class="alert alert-success d-none" id="fpAlertSuccess">
                        <i class="bi bi-check-circle me-1"></i>
                        If an account exists for that email, a reset link has been sent.
                    </div>
                    <div class="alert alert-danger d-none" id="fpAlertError">
                        <i class="bi bi-exclamation-octagon me-1"></i>
                        Could not send reset email. Please try again.
                    </div>

                    <form id="forgotForm" novalidate>
                        <div class="mb-3">
                            <label class="form-label">Email address</label>
                            <input type="email" class="form-control" id="fpEmail" placeholder="you@example.com"
                                required>
                            <div class="invalid-feedback">Please enter a valid email.</div>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-brand" type="submit">
                                <i class="bi bi-send me-1"></i>Send reset link
                            </button>
                            <button type="button" class="btn btn-outline-light" data-bs-toggle="modal"
                                data-bs-target="#loginModal" data-bs-dismiss="modal">
                                Back to Log in
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Reset Password MODAL -->
    <div class="modal fade auth-modal" id="resetModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0 d-flex justify-content-between align-items-center">
                    <h5 class="modal-title">
                        <i class="bi bi-shield-lock me-2"></i>Set a new password
                    </h5>
                    <button type="button" class="btn btn-outline-light btn-sm rounded-circle" data-bs-dismiss="modal"
                        aria-label="Close">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>

                <div class="modal-body">
                    <div class="small muted mb-3">Enter and confirm a strong password for your account.</div>

                    <!-- alerts -->
                    <div class="alert alert-success d-none" id="rpAlertSuccess">
                        <i class="bi bi-check2-circle me-1"></i>
                        Password updated. You can now sign in.
                    </div>
                    <div class="alert alert-danger d-none" id="rpAlertError">
                        <i class="bi bi-exclamation-octagon me-1"></i>
                        Reset failed. Your link may have expired. Request a new one.
                    </div>

                    <form id="resetForm" novalidate>
                        <div class="mb-3">
                            <label class="form-label">New password</label>
                            <input type="password" class="form-control" id="rpNew" minlength="8" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                                required>
                            <div class="invalid-feedback">Minimum 8 characters.</div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Confirm new password</label>
                            <input type="password" class="form-control" id="rpNew2" placeholder="Re-enter password"
                                required>
                            <div class="invalid-feedback">Passwords must match.</div>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-brand" type="submit">
                                <i class="bi bi-check2-circle me-1"></i>Reset password
                            </button>
                            <button type="button" class="btn btn-outline-light" data-bs-toggle="modal"
                                data-bs-target="#loginModal" data-bs-dismiss="modal">
                                Back to Log in
                            </button>
                        </div>
                        <div class="form-text text-secondary mt-2">Use 12+ characters with letters, numbers, and
                            symbols.
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="generalscript.js"></script> -->
    <script>

        // Redirect target after successful admin sign-in
        const ADMIN_DASH_URL = "admindashboard.html";

        // --- Admin approvals storage (demo) ---
        const ADMIN_KEYS = {
            APPS: 'tpt_admin_apps',         // Array of applications [{name,email,reason,at,status}]
            APPROVALS: 'tpt_admin_approvals',// Map: { "email@x.com": true }
            PENDING_EMAIL: 'tpt_admin_pending_email' // last email awaiting approval for this device
        };

        // Helper: check if an email is approved by Major Admin
        function isAdminApproved(email) {
            const map = JSON.parse(localStorage.getItem(ADMIN_KEYS.APPROVALS) || '{}');
            return !!map[(email || '').toLowerCase()];
        }

        // Open Sign-Up from the slash link in the Login footer
        document.getElementById('linkOpenAdminSignup')?.addEventListener('click', (e) => {
            e.preventDefault();
            sessionStorage.setItem('pendingRole', 'Admin'); // remember intent to become admin
            bootstrap.Modal.getInstance(document.getElementById('modalAdminLogin'))?.hide();
            bootstrap.Modal.getOrCreateInstance(document.getElementById('modalAdminSignup')).show();
        });

        // Handle Admin Sign-Up submit
        document.getElementById('formAdminSignup')?.addEventListener('submit', (e) => {
            e.preventDefault();

            const name = document.getElementById('suName').value.trim();
            const email = document.getElementById('suEmail').value.trim();
            const pass = document.getElementById('suPassword').value.trim();
            const reason = document.getElementById('suReason').value.trim();
            const invite = document.getElementById('suInvite').value.trim();

            if (!name || !/^\S+@\S+\.\S+$/.test(email) || !pass || pass.length < 6 || !reason) {
                alert('Please fill all required fields (valid email, 6+ char password).');
                return;
            }

            // Save/append application
            const apps = JSON.parse(localStorage.getItem(ADMIN_KEYS.APPS) || '[]');
            apps.unshift({ name, email, reason, at: new Date().toISOString(), status: 'pending' });
            localStorage.setItem(ADMIN_KEYS.APPS, JSON.stringify(apps));

            // Optional instant-approval via invite code (you can remove this if not desired)
            // Example: INVITE-ADMIN -> auto-approve:
            if (invite === 'INVITE-ADMIN') {
                const approvals = JSON.parse(localStorage.getItem(ADMIN_KEYS.APPROVALS) || '{}');
                approvals[email.toLowerCase()] = true;
                localStorage.setItem(ADMIN_KEYS.APPROVALS, JSON.stringify(approvals));
            }

            // If Major Admin has already approved this email, promote & redirect
            if (isAdminApproved(email)) {
                // Reuse your existing state model safely:
                try {
                    const state = {
                        set isAdmin(v) { localStorage.setItem("isAdmin", v ? "true" : "false"); },
                        set authed(v) { v ? localStorage.setItem("authToken", "demo-token") : localStorage.removeItem("authToken"); },
                        set role(r) { localStorage.setItem("role", r); },
                        get user() { try { return JSON.parse(localStorage.getItem("user")) || null; } catch { return null; } },
                        set user(u) { localStorage.setItem("user", JSON.stringify(u)); },
                    };
                    state.isAdmin = true;
                    state.authed = true;
                    state.role = "Admin";
                    state.user = { ...(state.user || {}), name, email };
                } catch { }

                // close modal then go
                bootstrap.Modal.getInstance(document.getElementById('modalAdminSignup'))?.hide();
                sessionStorage.removeItem('pendingRole');
                window.location.href = ADMIN_DASH_URL;
                return;
            }

            // Otherwise, mark as pending and inform the user
            localStorage.setItem(ADMIN_KEYS.PENDING_EMAIL, email);
            bootstrap.Modal.getInstance(document.getElementById('modalAdminSignup'))?.hide();
            alert('Your admin request was submitted and is pending approval by the Major Admin.');
        });

        // On load, if a user has a pending signup and has since been approved, auto-promote
        (function checkPendingApprovalOnLoad() {
            const email = localStorage.getItem(ADMIN_KEYS.PENDING_EMAIL);
            if (!email) return;
            if (!isAdminApproved(email)) return;

            // Promote now
            try {
                const state = {
                    set isAdmin(v) { localStorage.setItem("isAdmin", v ? "true" : "false"); },
                    set authed(v) { v ? localStorage.setItem("authToken", "demo-token") : localStorage.removeItem("authToken"); },
                    set role(r) { localStorage.setItem("role", r); },
                    get user() { try { return JSON.parse(localStorage.getItem("user")) || null; } catch { return null; } },
                    set user(u) { localStorage.setItem("user", JSON.stringify(u)); },
                };
                state.isAdmin = true;
                state.authed = true;
                state.role = "Admin";
                state.user = { ...(state.user || {}), name: (state.user?.name || "Administrator"), email };
            } catch { }

            localStorage.removeItem(ADMIN_KEYS.PENDING_EMAIL);
            const pending = sessionStorage.getItem('pendingRole');
            sessionStorage.removeItem('pendingRole');
            if (pending === 'Admin') {
                window.location.href = ADMIN_DASH_URL;
            }
        })();


        // Run in console on the Major Admin device/page to approve someone
        const k = 'tpt_admin_approvals', m = JSON.parse(localStorage.getItem(k) || '{}');
        m['newadmin@example.com'] = true;
        localStorage.setItem(k, JSON.stringify(m));


        // --- Utilities & Seed ---
        const fmtMoney = v => '‚Ç±' + Number(v).toLocaleString();
        const uid = p => p + Math.random().toString(36).slice(2, 7).toUpperCase();
        const nowISO = () => new Date().toISOString().slice(0, 10);

        const LS = {
            REQ: 'tpt_demo_requests', TX: 'tpt_demo_tx', MSG: 'tpt_demo_messages',
            BANK: 'tpt_demo_bank', PROFILE: 'tpt_demo_profile', PREFS: 'tpt_demo_prefs',
            KYC: 'tpt_demo_kyc', REFS: 'tpt_demo_refs'
        };

        function seed() {
            if (!localStorage.getItem(LS.REQ)) {
                localStorage.setItem(LS.REQ, JSON.stringify([
                    { id: 'R-1201', title: 'Emergency rent', cat: 'Housing', amount: 9000, status: 'Verified', created: '2025-10-04' },
                    { id: 'R-1202', title: 'Medication fund', cat: 'Medical', amount: 6000, status: 'Pending', created: '2025-10-08' },
                    { id: 'R-1203', title: 'Tuition & books', cat: 'Education', amount: 12000, status: 'Fulfilled', created: '2025-10-10' },
                    { id: 'R-1204', title: 'Clinic transport', cat: 'Medical', amount: 2400, status: 'Pending', created: '2025-10-14' }
                ]));
            }
            if (!localStorage.getItem(LS.TX)) {
                localStorage.setItem(LS.TX, JSON.stringify([
                    { date: '2025-10-12', type: 'Received', ref: 'R-1203', amount: 12000, status: 'Completed' },
                    { date: '2025-10-13', type: 'Provided', ref: 'R-9932', amount: 5000, status: 'Completed' },
                    { date: '2025-10-14', type: 'Add Funds', ref: 'TOPUP-114', amount: 10000, status: 'Completed' }
                ]));
            }
            if (!localStorage.getItem(LS.MSG)) {
                localStorage.setItem(LS.MSG, JSON.stringify([
                    {
                        id: 'C-1', title: 'Verification Help', with: 'Reviewer Team', last: '2025-10-13', thread: [
                            { me: false, text: 'Hi, we received your ID. Please add a selfie.', at: '2025-10-13 10:04' },
                            { me: true, text: 'Uploaded now, thanks!', at: '2025-10-13 10:10' }
                        ]
                    },
                    {
                        id: 'C-2', title: 'Proof of transfer', with: 'Marcus M.', last: '2025-10-14', thread: [
                            { me: false, text: 'I sent ‚Ç±6,000 for R-1201. Receipt attached.', at: '2025-10-14 07:20' },
                            { me: true, text: 'Confirmed, thank you!', at: '2025-10-14 07:35' }
                        ]
                    }
                ]));
            }
            if (!localStorage.getItem(LS.REFS)) {
                const base = location.origin + location.pathname.replace(/[^/]+$/, '');
                localStorage.setItem(LS.REFS, JSON.stringify({
                    link: base + '?ref=ABC123',
                    list: [
                        { name: 'Ana L√≥pez', email: 'ana@example.com', joined: '2025-09-21', status: 'Active' },
                        { name: 'Jos√© Perez', email: 'jose@example.com', joined: '2025-10-01', status: 'Pending' }
                    ],
                    stats: { count: 2, active: 1, bonus: 1500 }
                }));
            }
            if (!localStorage.getItem(LS.PROFILE)) {
                localStorage.setItem(LS.PROFILE, JSON.stringify({ name: 'Friend', email: 'friend@example.com', phone: '', city: '' }));
            }
            if (!localStorage.getItem(LS.PREFS)) {
                localStorage.setItem(LS.PREFS, JSON.stringify({ email: true, sms: false, anon: true, lang: 'Espa√±ol' }));
            }
        }
        seed();

        document.getElementById('year').textContent = new Date().getFullYear();
        const sidebar = document.getElementById('sidebar');
        document.getElementById('btnToggleSidebar')?.addEventListener('click', () => sidebar.classList.toggle('open'));

        // Load profile
        const profile = JSON.parse(localStorage.getItem(LS.PROFILE));
        document.getElementById('usernameTop').textContent = profile.name || 'Dear Friend!';
        document.getElementById('badgeRank').textContent = 'Member';

        // KPIs from transactions
        function refreshKPIs() {
            const tx = JSON.parse(localStorage.getItem(LS.TX) || '[]');
            const received = tx.filter(t => t.type === 'Received').reduce((a, b) => a + b.amount, 0);
            const provided = tx.filter(t => t.type === 'Provided').reduce((a, b) => a + b.amount, 0);
            const balance = tx.reduce((a, b) => a + (b.type === 'Add Funds' ? b.amount : 0) + (b.type === 'Received' ? b.amount : 0) - (b.type === 'Provided' ? b.amount : 0), 0);
            const fulfillment = Math.min(100, Math.round((received / Math.max(received + provided, 1)) * 100));

            document.getElementById('kpiBalance').textContent = fmtMoney(balance);
            document.getElementById('kpiReceived').textContent = fmtMoney(received);
            document.getElementById('kpiProvided').textContent = fmtMoney(provided);
            document.getElementById('kpiFulfillment').textContent = fulfillment + '%';
            document.getElementById('pbBalance').style.width = Math.min(100, (balance % 100)) + '%';
            document.getElementById('pbReceived').style.width = Math.min(100, (received % 100)) + '%';
            document.getElementById('pbProvided').style.width = Math.min(100, (provided % 100)) + '%';
            document.getElementById('pbFulfillment').style.width = fulfillment + '%';
            document.getElementById('walletBalance').textContent = fmtMoney(balance);
        }
        refreshKPIs();

        // Charts
        const chartActivity = new Chart(document.getElementById('chartActivity'), {
            type: 'line',
            data: {
                labels: Array.from({ length: 12 }, (_, i) => `D${i + 1}`),
                datasets: [{ label: 'Received', data: [4, 5, 3, 6, 7, 9, 6, 8, 7, 10, 8, 9], tension: .35 },
                { label: 'Provided', data: [2, 3, 2, 5, 4, 6, 3, 5, 4, 6, 5, 5], tension: .35 }]
            },
            options: {
                plugins: { legend: { labels: { color: '#cbd5e1' } } },
                scales: {
                    x: { ticks: { color: '#9fb0c9' }, grid: { color: 'rgba(255,255,255,.06)' } },
                    y: { ticks: { color: '#9fb0c9' }, grid: { color: 'rgba(255,255,255,.06)' } }
                }
            }
        });
        new Chart(document.getElementById('chartSplit'), {
            type: 'doughnut',
            data: { labels: ['Medical', 'Education', 'Housing'], datasets: [{ data: [45, 35, 20] }] },
            options: { plugins: { legend: { labels: { color: '#cbd5e1' } } } }
        });
        new Chart(document.getElementById('chartWallet'), {
            type: 'bar',
            data: { labels: ['W1', 'W2', 'W3', 'W4'], datasets: [{ label: 'Net', data: [2, 4, 3, 5] }] },
            options: {
                plugins: { legend: { labels: { color: '#cbd5e1' } } },
                scales: { x: { ticks: { color: '#9fb0c9' } }, y: { ticks: { color: '#9fb0c9' } } }
            }
        });
        const chartReferrals = new Chart(document.getElementById('chartReferrals'), {
            type: 'bar',
            data: { labels: ['Aug', 'Sep', 'Oct'], datasets: [{ label: 'Referrals', data: [1, 2, 3] }] },
            options: {
                plugins: { legend: { labels: { color: '#cbd5e1' } } },
                scales: { x: { ticks: { color: '#9fb0c9' } }, y: { ticks: { color: '#9fb0c9' } } }
            }
        });

        // Requests (Kanban + Table)
        function renderReqCard(r) {
            return `<div class="req-card">
      <div class="title">${r.title}</div>
      <div class="meta">${r.id} ‚Ä¢ ${r.cat} ‚Ä¢ ${r.created}</div>
      <div class="fw-bold mt-1">${fmtMoney(r.amount)}</div>
      <div class="d-flex gap-1 mt-2">
        <button class="btn btn-sm btn-outline-light" data-id="${r.id}" data-action="view"><i class="bi bi-eye"></i></button>
        <button class="btn btn-sm btn-outline-light" data-id="${r.id}" data-action="edit"><i class="bi bi-pencil"></i></button>
        <button class="btn btn-sm btn-outline-light" data-id="${r.id}" data-action="del"><i class="bi bi-trash"></i></button>
      </div>
    </div>`;
        }
        function refreshRequests() {
            const reqs = JSON.parse(localStorage.getItem(LS.REQ) || '[]');
            // Kanban
            document.getElementById('colPending').innerHTML = reqs.filter(r => r.status === 'Pending').map(renderReqCard).join('');
            document.getElementById('colVerified').innerHTML = reqs.filter(r => r.status === 'Verified').map(renderReqCard).join('');
            document.getElementById('colFulfilled').innerHTML = reqs.filter(r => r.status === 'Fulfilled').map(renderReqCard).join('');
            // Table
            const term = (document.getElementById('rqSearch').value || '').toLowerCase();
            const filt = document.getElementById('rqFilter').value || '';
            const rows = reqs.filter(r => (!filt || r.status === filt) && (!term || r.title.toLowerCase().includes(term) || r.id.toLowerCase().includes(term)));
            const tbody = document.getElementById('tblRequests'); tbody.innerHTML = '';
            rows.forEach(r => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${r.id}</td><td>${r.title}</td><td>${r.cat}</td><td>${fmtMoney(r.amount)}</td>
        <td><span class="badge ${r.status === 'Fulfilled' ? 'text-bg-success' : (r.status === 'Verified' ? 'text-bg-info' : 'text-bg-warning')}">${r.status}</span></td>
        <td class="small">${r.created}</td>
        <td class="text-end">
          <button class="btn btn-sm btn-outline-light" data-id="${r.id}" data-action="view"><i class="bi bi-eye"></i></button>
          <button class="btn btn-sm btn-outline-light" data-id="${r.id}" data-action="edit"><i class="bi bi-pencil"></i></button>
          <button class="btn btn-sm btn-outline-light" data-id="${r.id}" data-action="del"><i class="bi bi-trash"></i></button>
        </td>`;
                tbody.appendChild(tr);
            });
        }
        refreshRequests();
        document.getElementById('rqSearch').addEventListener('input', refreshRequests);
        document.getElementById('rqFilter').addEventListener('change', refreshRequests);

        // Provide Help grid
        let phPage = 0, phPageSize = 6;
        function refreshProvide() {
            const grid = document.getElementById('provideGrid');
            const reqs = JSON.parse(localStorage.getItem(LS.REQ) || '[]').filter(r => r.status !== 'Fulfilled');
            const term = (document.getElementById('phSearch').value || '').toLowerCase();
            const filter = document.getElementById('phFilter').value || '';
            const sort = document.getElementById('phSort').value || 'latest';
            let arr = reqs.filter(r => (!filter || r.cat === filter) && (!term || r.title.toLowerCase().includes(term) || r.id.toLowerCase().includes(term)));
            if (sort === 'amount') arr.sort((a, b) => b.amount - a.amount); else arr.sort((a, b) => b.created.localeCompare(a.created));
            const start = phPage * phPageSize; const pageItems = arr.slice(start, start + phPageSize);

            grid.innerHTML = '';
            pageItems.forEach(r => {
                const col = document.createElement('div'); col.className = 'col-md-6 col-xl-4';
                col.innerHTML = `
        <div class="cardx p-3 h-100">
          <div class="d-flex justify-content-between align-items-start">
            <div><div class="fw-semibold">${r.title}</div><div class="small muted">${r.id} ‚Ä¢ ${r.cat}</div></div>
            <span class="badge ${r.status === 'Verified' ? 'text-bg-info' : 'text-bg-warning'}">${r.status}</span>
          </div>
          <div class="display-6 fw-bold mt-2">${fmtMoney(r.amount)}</div>
          <div class="muted small">Created: ${r.created}</div>
          <button class="btn btn-sm mt-2" data-bs-toggle="modal" data-bs-target="#modalSendHelp" data-prefref="${r.id}"><i class="bi bi-arrow-up-right-circle me-1"></i>Send Help</button>
        </div>`;
                grid.appendChild(col);
            });
        }
        refreshProvide();
        ['phSearch', 'phFilter', 'phSort'].forEach(id => document.getElementById(id).addEventListener('input', () => { phPage = 0; refreshProvide(); }));
        document.getElementById('phPrev').addEventListener('click', () => { phPage = Math.max(0, phPage - 1); refreshProvide(); });
        document.getElementById('phNext').addEventListener('click', () => { phPage = phPage + 1; refreshProvide(); });
        document.getElementById('modalSendHelp').addEventListener('show.bs.modal', (ev) => {
            const btn = ev.relatedTarget;
            if (btn?.dataset.prefref) document.getElementById('shRef').value = btn.dataset.prefref;
        });

        // Requests actions
        function getReqById(id) { return (JSON.parse(localStorage.getItem(LS.REQ) || '[]')).find(x => x.id === id); }
        document.getElementById('tblRequests').addEventListener('click', onReqAction);
        document.getElementById('colPending').addEventListener('click', onReqAction);
        document.getElementById('colVerified').addEventListener('click', onReqAction);
        document.getElementById('colFulfilled').addEventListener('click', onReqAction);
        function onReqAction(e) {
            const btn = e.target.closest('button[data-action]'); if (!btn) return;
            const id = btn.dataset.id; const action = btn.dataset.action;
            const reqs = JSON.parse(localStorage.getItem(LS.REQ) || '[]');
            if (action === 'del') { localStorage.setItem(LS.REQ, JSON.stringify(reqs.filter(r => r.id !== id))); refreshRequests(); refreshProvide(); return; }
            if (action === 'edit') {
                const r = reqs.find(x => x.id === id);
                const m = new bootstrap.Modal(document.getElementById('modalNewRequest'));
                document.getElementById('rqTitle').value = r.title;
                document.getElementById('rqCat').value = r.cat;
                document.getElementById('rqAmt').value = r.amount;
                document.getElementById('rqDesc').value = 'Edit description‚Ä¶';
                document.getElementById('rqBank').value = 'Edit bank‚Ä¶';
                m.show(); return;
            }
            if (action === 'view') {
                alert(`${id}\n${getReqById(id).title}\n${getReqById(id).cat} ‚Ä¢ ${fmtMoney(getReqById(id).amount)} ‚Ä¢ ${getReqById(id).status}`);
            }
        }

        // New Request submit
        document.getElementById('formNewRequest').addEventListener('submit', (e) => {
            e.preventDefault();
            const reqs = JSON.parse(localStorage.getItem(LS.REQ) || '[]');
            const r = {
                id: uid('R-'),
                title: document.getElementById('rqTitle').value.trim(),
                cat: document.getElementById('rqCat').value,
                amount: Number(document.getElementById('rqAmt').value),
                status: 'Pending',
                created: nowISO()
            };
            reqs.unshift(r);
            localStorage.setItem(LS.REQ, JSON.stringify(reqs));
            refreshRequests(); refreshProvide();
            bootstrap.Modal.getInstance(document.getElementById('modalNewRequest'))?.hide();
            e.target.reset();
            alert('Request published (demo).');
        });

        // Send Help
        document.getElementById('formSendHelp').addEventListener('submit', (e) => {
            e.preventDefault();
            const ref = document.getElementById('shRef').value.trim();
            const amt = Number(document.getElementById('shAmt').value);
            const tx = JSON.parse(localStorage.getItem(LS.TX) || '[]');
            tx.unshift({ date: nowISO(), type: 'Provided', ref, amount: amt, status: 'Completed' });
            localStorage.setItem(LS.TX, JSON.stringify(tx));
            refreshTx(); refreshKPIs();
            bootstrap.Modal.getInstance(document.getElementById('modalSendHelp'))?.hide();
            e.target.reset();
            alert('Help sent (demo). Keep receipts.');
        });

        // Wallet & Transactions
        function refreshTx() {
            const term = (document.getElementById('txSearch')?.value || '').toLowerCase();
            const tbody = document.getElementById('tblTx'); tbody.innerHTML = '';
            JSON.parse(localStorage.getItem(LS.TX) || '[]')
                .filter(t => !term || t.ref.toLowerCase().includes(term) || t.type.toLowerCase().includes(term))
                .forEach(t => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td class="small">${t.date}</td><td class="small">${t.type}</td><td class="small">${t.ref}</td><td class="small">${fmtMoney(t.amount)}</td>
          <td class="small"><span class="badge ${t.status === 'Completed' ? 'text-bg-success' : 'text-bg-warning'}">${t.status}</span></td>`;
                    tbody.appendChild(tr);
                });
        }
        refreshTx();
        document.getElementById('txSearch').addEventListener('input', refreshTx);

        document.getElementById('formAddFunds').addEventListener('submit', (e) => {
            e.preventDefault();
            const amt = Number(document.getElementById('afAmt').value);
            const tx = JSON.parse(localStorage.getItem(LS.TX) || '[]');
            tx.unshift({ date: nowISO(), type: 'Add Funds', ref: uid('TOPUP-'), amount: amt, status: 'Completed' });
            localStorage.setItem(LS.TX, JSON.stringify(tx));
            refreshTx(); refreshKPIs();
            bootstrap.Modal.getInstance(document.getElementById('modalAddFunds'))?.hide();
            e.target.reset();
        });
        document.getElementById('formWithdraw').addEventListener('submit', (e) => {
            e.preventDefault();
            const amt = Number(document.getElementById('wdAmt').value);
            const tx = JSON.parse(localStorage.getItem(LS.TX) || '[]');
            tx.unshift({ date: nowISO(), type: 'Withdraw', ref: uid('WD-'), amount: amt, status: 'Pending' });
            localStorage.setItem(LS.TX, JSON.stringify(tx));
            refreshTx(); refreshKPIs();
            bootstrap.Modal.getInstance(document.getElementById('modalWithdraw'))?.hide();
            e.target.reset();
        });
        // Bank
        const bank = JSON.parse(localStorage.getItem(LS.BANK) || 'null');
        document.getElementById('bankInfo').textContent = bank ? `${bank.name} ‚Ä¢ ${bank.bank} ‚Ä¢ ${bank.number}` : 'Not set';
        document.getElementById('formBank').addEventListener('submit', (e) => {
            e.preventDefault();
            const data = { name: bkName.value.trim(), number: bkNumber.value.trim(), bank: bkBank.value.trim() };
            localStorage.setItem(LS.BANK, JSON.stringify(data));
            document.getElementById('bankInfo').textContent = `${data.name} ‚Ä¢ ${data.bank} ‚Ä¢ ${data.number}`;
            bootstrap.Modal.getInstance(document.getElementById('modalBank'))?.hide();
            e.target.reset();
        });
        document.getElementById('btnExportCsv').addEventListener('click', () => {
            const tx = JSON.parse(localStorage.getItem(LS.TX) || '[]');
            const rows = [['Date', 'Type', 'Ref', 'Amount', 'Status']].concat(tx.map(t => [t.date, t.type, t.ref, t.amount, t.status]));
            const csv = rows.map(r => r.map(v => `"${String(v).replace(/"/g, '""')}"`).join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'transactions.csv'; a.click(); URL.revokeObjectURL(a.href);
        });

        // Messages
        function refreshInbox() {
            const list = JSON.parse(localStorage.getItem(LS.MSG) || '[]');
            const el = document.getElementById('msgList'); el.innerHTML = '';
            list.forEach(c => {
                const a = document.createElement('a');
                a.href = '#'; a.className = 'list-group-item list-group-item-action d-flex justify-content-between align-items-center';
                a.dataset.cid = c.id;
                a.innerHTML = `<span><i class="bi bi-chat-left-text me-2"></i>${c.title} <span class="muted small">‚Ä¢ ${c.with}</span></span><span class="small muted">${c.last}</span>`;
                el.appendChild(a);
            });
        }
        function openConversation(cid) {
            const list = JSON.parse(localStorage.getItem(LS.MSG) || '[]'); const c = list.find(x => x.id === cid); if (!c) return;
            msgTitle.textContent = c.title; msgMeta.textContent = c.with + ' ‚Ä¢ ' + c.last;
            const thread = document.getElementById('msgThread'); thread.innerHTML = ''; thread.dataset.cid = cid;
            c.thread.forEach(m => {
                const row = document.createElement('div'); row.className = 'd-flex ' + (m.me ? 'justify-content-end' : 'justify-content-start');
                row.innerHTML = `<div class="p-2 rounded-3 ${m.me ? 'bg-primary text-dark' : 'bg-dark text-light'}" style="max-width:70%">${m.text}<div class="small muted mt-1">${m.at}</div></div>`;
                thread.appendChild(row);
            });
            thread.scrollTop = thread.scrollHeight;
        }
        refreshInbox();
        document.getElementById('msgList').addEventListener('click', (e) => {
            const a = e.target.closest('a[data-cid]'); if (!a) return; e.preventDefault(); openConversation(a.dataset.cid);
        });
        document.getElementById('btnNewMessage').addEventListener('click', () => {
            const list = JSON.parse(localStorage.getItem(LS.MSG) || '[]');
            const id = uid('C-'); list.unshift({ id, title: 'New conversation', with: 'Support', last: nowISO(), thread: [] });
            localStorage.setItem(LS.MSG, JSON.stringify(list)); refreshInbox(); openConversation(id);
        });
        document.getElementById('msgAttach').addEventListener('change', (e) => {
            document.getElementById('msgAttachName').textContent = e.target.files[0] ? `Attached: ${e.target.files[0].name}` : '';
        });
        document.getElementById('formSendMessage').addEventListener('submit', (e) => {
            e.preventDefault();
            const cid = msgThread.dataset.cid; if (!cid) return;
            const txt = msgInput.value.trim(); if (!txt) return;
            const list = JSON.parse(localStorage.getItem(LS.MSG) || '[]'); const c = list.find(x => x.id === cid);
            c.thread.push({ me: true, text: txt, at: new Date().toISOString().slice(0, 16).replace('T', ' ') });
            c.last = nowISO(); localStorage.setItem(LS.MSG, JSON.stringify(list));
            msgInput.value = ''; msgAttach.value = ''; msgAttachName.textContent = ''; openConversation(cid); refreshInbox();
        });

        // Referrals
        function refreshRefs() {
            const data = JSON.parse(localStorage.getItem(LS.REFS) || '{}');
            inviteLink.value = data.link || (location.href + '?ref=ABC123');
            refCount.textContent = data.stats?.count || 0;
            refActive.textContent = data.stats?.active || 0;
            refBonus.textContent = fmtMoney(data.stats?.bonus || 0);
            const tbody = document.getElementById('tblReferrals'); tbody.innerHTML = '';
            (data.list || []).forEach(r => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${r.name}</td><td class="small">${r.email}</td><td class="small">${r.joined}</td><td class="small">${r.status}</td>`;
                tbody.appendChild(tr);
            });
        }
        refreshRefs();
        document.getElementById('btnCopyInvite').addEventListener('click', async () => {
            await navigator.clipboard.writeText(document.getElementById('inviteLink').value);
            alert('Invite link copied!');
        });

        // Verification
        document.getElementById('pName').value = profile.name || '';
        document.getElementById('pEmail').value = profile.email || '';
        document.getElementById('pPhone').value = profile.phone || '';
        document.getElementById('pCity').value = profile.city || '';
        document.getElementById('formProfile').addEventListener('submit', (e) => {
            e.preventDefault();
            const p = { name: pName.value.trim(), email: pEmail.value.trim(), phone: pPhone.value.trim(), city: pCity.value.trim() };
            localStorage.setItem(LS.PROFILE, JSON.stringify(p)); usernameTop.textContent = p.name || 'Friend'; alert('Profile saved (demo).');
        });
        const kyc = JSON.parse(localStorage.getItem(LS.KYC) || '{}');
        document.getElementById('kycStatus').textContent = kyc.status || 'Not submitted';
        document.getElementById('formKyc').addEventListener('submit', (e) => {
            e.preventDefault(); localStorage.setItem(LS.KYC, JSON.stringify({ status: 'Submitted ' + nowISO() }));
            document.getElementById('kycStatus').textContent = 'Submitted ' + nowISO(); alert('KYC submitted (demo).');
        });

        // Preferences & Security
        const prefs = JSON.parse(localStorage.getItem(LS.PREFS) || '{}');
        prefEmail.checked = !!prefs.email; prefSms.checked = !!prefs.sms; prefAnon.checked = !!prefs.anon; prefLang.value = prefs.lang || 'Espa√±ol';
        formPrefs.addEventListener('submit', (e) => {
            e.preventDefault();
            const p = { email: prefEmail.checked, sms: prefSms.checked, anon: prefAnon.checked, lang: prefLang.value };
            localStorage.setItem(LS.PREFS, JSON.stringify(p)); alert('Preferences saved (demo).');
        });
        formSecurity.addEventListener('submit', (e) => {
            e.preventDefault(); if (secNew.value && secNew.value === secNew2.value) { alert('Security updated (demo).'); e.target.reset(); } else { alert('Passwords do not match.'); }
        });

        // ---------- Tab hash support (NEW) ----------
        // Activate tab from URL hash (e.g., ...#tab-messages)
        if (location.hash) {
            const trigger = document.querySelector(`[data-bs-target="${location.hash}"]`);
            if (trigger) new bootstrap.Tab(trigger).show();
        }
        // Keep URL hash in sync with active tab
        document.querySelectorAll('[data-bs-toggle="tab"]').forEach(el => {
            el.addEventListener('shown.bs.tab', e => {
                const target = e.target.getAttribute('data-bs-target');
                if (target) history.replaceState(null, '', target);
                // close sidebar on mobile after navigation
                sidebar?.classList.remove('open');
            });
        });



        /* ===== Add/extend localStorage keys (non-breaking) ===== */
        LS.MOD = LS.MOD || 'tpt_modules_v1';      // School modules
        LS.WAL = LS.WAL || 'tpt_wallet_v1';       // Demo FEL wallet (separate from TX)
        LS.ACT = LS.ACT || 'tpt_activity_v1';     // Lightweight activity log

        /* ===== School seed ===== */
        function seedSchool() {
            if (!localStorage.getItem(LS.MOD)) {
                localStorage.setItem(LS.MOD, JSON.stringify([
                    { id: 1, title: 'Community policies', done: false },
                    { id: 2, title: 'How verification works', done: false },
                    { id: 3, title: 'Writing a clear request', done: false },
                    { id: 4, title: 'Responsible inviting', done: false },
                    { id: 5, title: 'Privacy & consent', done: false },
                    { id: 6, title: 'Receipts & reporting', done: false },
                ]));
            }
            if (!localStorage.getItem(LS.WAL)) {
                localStorage.setItem(LS.WAL, JSON.stringify([{ type: 'credit', val: 2000, note: 'Welcome bonus (demo)', at: new Date().toISOString() }]));
            }
            if (!localStorage.getItem(LS.ACT)) {
                localStorage.setItem(LS.ACT, JSON.stringify([{ t: 'Opened TPT School', at: new Date().toISOString() }]));
            }
        }

        /* ===== School renderers ===== */
        function renderModules() {
            const holder = document.getElementById('modules'); if (!holder) return;
            holder.innerHTML = '';
            const mods = JSON.parse(localStorage.getItem(LS.MOD) || '[]');
            const done = mods.filter(m => m.done).length;
            const prog = document.getElementById('modProgress'); if (prog) prog.textContent = `${done}/${mods.length} complete`;

            mods.forEach(m => {
                const col = document.createElement('div');
                col.className = 'col-12';
                col.innerHTML = `
      <div class="panel p-3 d-flex flex-column gap-2">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h6 class="mb-1">${m.title}</h6>
            <p class="small muted mb-0">Short lesson with a quiz.</p>
          </div>
          <span class="chip">Module ${m.id}</span>
        </div>
        <div class="d-flex justify-content-end">
          <button class="btn btn-sm ${m.done ? '' : ''}" style="${m.done ? '' : ''}" data-mod="${m.id}">
            ${m.done ? 'Completed' : '<i class="bi bi-play-circle me-1"></i>Start'}
          </button>
        </div>
      </div>`;
                holder.appendChild(col);
            });
        }

        function renderWallet() {
            const ul = document.getElementById('walletList'); if (!ul) return;
            ul.innerHTML = '';
            (JSON.parse(localStorage.getItem(LS.WAL) || '[]')).slice().reverse().forEach(w => {
                const li = document.createElement('li');
                li.className = 'list-group-item bg-transparent text-light d-flex justify-content-between';
                li.innerHTML = `<span>${w.type === 'credit' ? '+' : '-'} FEL ${w.val} ‚Äî ${w.note || ''}</span>
                    <span class="small muted">${new Date(w.at).toLocaleDateString()}</span>`;
                ul.appendChild(li);
            });
            const bal = (JSON.parse(localStorage.getItem(LS.WAL) || '[]'))
                .reduce((a, x) => a + (x.type === 'credit' ? x.val : -x.val), 0);
            const wBal = document.getElementById('wBalance'); if (wBal) wBal.textContent = 'FEL ' + bal.toLocaleString();
        }

        function renderTips() {
            const tips = [
                'Complete modules to unlock request guidance.',
                'Keep captions respectful and concise when uploading videos.',
                'Never promise returns ‚Äî donations only.',
            ];
            const el = document.getElementById('tips');
            if (el) el.innerHTML = tips.map(t => `<div class="mb-1">‚Ä¢ ${t}</div>`).join('');
        }

        /* ===== Activity helper ===== */
        function addActivity(t) {
            const arr = JSON.parse(localStorage.getItem(LS.ACT) || '[]');
            arr.push({ t, at: new Date().toISOString() });
            localStorage.setItem(LS.ACT, JSON.stringify(arr));
        }

        /* ===== Bind School tab behaviors ===== */
        function bindSchool() {
            // Year (shared)
            const yr = document.getElementById('year'); if (yr) yr.textContent = new Date().getFullYear();

            // Toggle module completed
            document.getElementById('tab-school')?.addEventListener('click', (e) => {
                const b = e.target.closest('button[data-mod]'); if (!b) return;
                const id = +b.dataset.mod;
                const mods = JSON.parse(localStorage.getItem(LS.MOD) || '[]');
                const m = mods.find(x => x.id === id); if (!m) return;
                m.done = !m.done;
                localStorage.setItem(LS.MOD, JSON.stringify(mods));
                addActivity((m.done ? 'Completed: ' : 'Reopened: ') + m.title);
                renderModules();
            });

            // Upload form
            document.getElementById('uploadForm')?.addEventListener('submit', (e) => {
                e.preventDefault();
                const f = e.target;
                if (!f.checkValidity()) { f.classList.add('was-validated'); return; }
                addActivity('Uploaded testimonial video');
                bootstrap.Modal.getInstance(document.getElementById('uploadModal'))?.hide();
                f.reset();
            });

            // Wallet demo
            document.getElementById('addFeliz')?.addEventListener('click', () => {
                const w = JSON.parse(localStorage.getItem(LS.WAL) || '[]');
                w.push({ type: 'credit', val: 500, note: 'Demo top-up', at: new Date().toISOString() });
                localStorage.setItem(LS.WAL, JSON.stringify(w));
                renderWallet();
            });
            document.getElementById('convertCash')?.addEventListener('click', () => {
                const w = JSON.parse(localStorage.getItem(LS.WAL) || '[]');
                const bal = w.reduce((a, x) => a + (x.type === 'credit' ? x.val : -x.val), 0);
                if (bal <= 0) return alert('No balance');
                alert(`Demo convert: FEL ${bal.toLocaleString()} ‚Üí MX$${bal.toLocaleString()}`);
                addActivity('Converted FEL to MXN (demo)');
            });
        }

        /* ===== Boot when tab opens and on load ===== */
        function bootSchool() {
            seedSchool();
            renderModules();
            renderWallet();
            renderTips();
            bindSchool();
        }

        // If page loads on School or user navigates to it, ensure render
        bootSchool();
        document.querySelector('#tablink-school')?.addEventListener('shown.bs.tab', () => {
            renderModules(); renderWallet(); renderTips();
        });


        // ----- User role switcher & avatar menu (demo) -----
        (function () {
            const qs = (s, r = document) => r.querySelector(s);
            const qsa = (s, r = document) => [...r.querySelectorAll(s)];

            // ---- State helpers (demo) ----
            const state = {
                get user() {
                    try { return JSON.parse(localStorage.getItem("user")) || null; } catch { return null; }
                },
                set user(u) { localStorage.setItem("user", JSON.stringify(u)); },

                get role() { return localStorage.getItem("role") || "Member"; },
                set role(r) { localStorage.setItem("role", r); },

                get authed() { return !!localStorage.getItem("authToken"); },
                set authed(v) { v ? localStorage.setItem("authToken", "demo-token") : localStorage.removeItem("authToken"); },

                get isAdmin() { return localStorage.getItem("isAdmin") === "true"; },
                set isAdmin(v) { localStorage.setItem("isAdmin", v ? "true" : "false"); },
            };

            // ---- UI bind ----
            function renderUserBits() {
                // Name / Email (avatar dropdown)
                const name = state.user?.name || "Friend";
                const email = state.user?.email || "friend@example.com";
                const role = state.role;

                const badge = qs("#badgeRank");
                const usernameTop = qs("#usernameTop");
                const ddName = qs("#ddName");
                const ddEmail = qs("#ddEmail");

                if (badge) badge.textContent = role;
                if (usernameTop) usernameTop.textContent = name;
                if (ddName) ddName.textContent = name;
                if (ddEmail) ddEmail.textContent = email;

                // If not authed, still show Member role by default
                if (!state.authed && badge) badge.textContent = "Member";
            }

            function wireRoleSwitcher() {
                const qs = (s, r = document) => r.querySelector(s);
                const qsa = (s, r = document) => [...r.querySelectorAll(s)];

                qsa(".role-option").forEach(a => {
                    a.addEventListener("click", (e) => {
                        e.preventDefault();
                        const newRole = a.dataset.role; // "Member" or "Admin"
                        state.role = newRole;

                        if (newRole === "Admin" && !state.isAdmin) {
                            // Remember the user intended to switch to Admin, then show your existing modal
                            sessionStorage.setItem("pendingRole", "Admin");
                            bootstrap.Modal.getOrCreateInstance(qs("#modalAdminLogin")).show();
                            return;
                        }

                        // If already admin or switching back to Member, just update UI
                        const badge = qs("#badgeRank");
                        if (badge) badge.textContent = newRole;
                    });
                });
            }

            function wireAvatarMenu() {
                const btnLoginAsAdmin = qs("#btnLoginAsAdmin");
                const adminLoginModal = qs("#modalAdminLogin");
                const formAdminLogin = qs("#formAdminLogin");

                // Explicit "Login as Admin" action
                btnLoginAsAdmin?.addEventListener("click", (e) => {
                    e.preventDefault();
                    bootstrap.Modal.getOrCreateInstance(adminLoginModal).show();
                });

                // Fake/real admin login submit (replace this block in wireAvatarMenu)
                formAdminLogin?.addEventListener("submit", async (e) => {
                    e.preventDefault();

                    const email = document.getElementById("adminEmail")?.value.trim();
                    const pass = document.getElementById("adminPassword")?.value.trim();
                    const remember = document.getElementById("rememberMe")?.checked;

                    // Basic client validation (swap for your real API if you have one)
                    if (!email || !/^\S+@\S+\.\S+$/.test(email) || !pass) {
                        alert("Please enter a valid admin email and password.");
                        return;
                    }

                    // TODO: call your backend here. On success, set flags:
                    state.isAdmin = true;
                    state.authed = true;
                    state.role = "Admin";
                    state.user = { ...(state.user || {}), name: state.user?.name || "Administrator", email };

                    if (remember) localStorage.setItem("adminEmailRemember", email);
                    else localStorage.removeItem("adminEmailRemember");

                    // Close modal & refresh UI bits
                    bootstrap.Modal.getInstance(adminLoginModal)?.hide();
                    renderUserBits();

                    // If the modal was opened by choosing Admin, redirect now
                    const pending = sessionStorage.getItem("pendingRole");
                    sessionStorage.removeItem("pendingRole");
                    if (pending === "Admin") {
                        window.location.href = ADMIN_DASH_URL; // -> admindashboard.html
                    }
                });

                // Logout
                const btnLogout = qs("#btnLogout");
                const confirmModalEl = qs("#modalConfirmLogout");
                const loggedOutModalEl = qs("#modalLoggedOut");
                const confirmModal = bootstrap.Modal.getOrCreateInstance(confirmModalEl);
                const loggedOutModal = bootstrap.Modal.getOrCreateInstance(loggedOutModalEl);

                btnLogout?.addEventListener("click", (e) => {
                    e.preventDefault();
                    confirmModal.show();
                });

                qs("#confirmLogout")?.addEventListener("click", () => {
                    // Clear demo auth
                    ["authToken", "isAdmin"].forEach(k => localStorage.removeItem(k));
                    // Keep user profile, but reset role to Member
                    state.role = "Member";
                    confirmModal.hide();
                    setTimeout(() => loggedOutModal.show(), 220);
                    renderUserBits();
                });
            }

            document.addEventListener("DOMContentLoaded", () => {
                // Seed demo user if none
                if (!state.user) state.user = { name: "Friend", email: "friend@example.com" };

                // If authed not set, assume authed in dashboard view (demo)
                if (state.authed === false) state.authed = true;

                // ‚úÖ Normalize role on every load/login:
                // If the user is NOT an approved admin, force role back to "Member"
                if (localStorage.getItem("isAdmin") !== "true") {
                    state.role = "Member";
                }

                // Also make sure the top badge shows Member unless explicitly admin
                const badge = document.querySelector("#badgeRank");
                if (badge && localStorage.getItem("isAdmin") !== "true") {
                    badge.textContent = "Member";
                }

                renderUserBits();
                wireRoleSwitcher();
                wireAvatarMenu();
            });


        })();



        // Helper: show tab by its LINK id (not the pane)
        function openTabByLinkId(linkSelector, evtTarget) {
            const linkEl = document.querySelector(linkSelector);
            if (!linkEl) return;
            bootstrap.Tab.getOrCreateInstance(linkEl).show();

            // Optional: close the dropdown after click
            const menu = evtTarget?.closest?.('.dropdown-menu');
            if (menu) {
                const toggle = menu.parentElement?.querySelector('[data-bs-toggle="dropdown"]');
                if (toggle) bootstrap.Dropdown.getOrCreateInstance(toggle).hide();
            }
        }

        // Wire dropdown items -> sidebar tablinks
        document.getElementById("openProfileTab")?.addEventListener("click", e => {
            e.preventDefault(); openTabByLinkId('#tablink-profile', e.target);
        });
        document.getElementById("openMessagesTab")?.addEventListener("click", e => {
            e.preventDefault(); openTabByLinkId('#tablink-messages', e.target);
        });
        document.getElementById("openSettingsTab")?.addEventListener("click", e => {
            e.preventDefault(); openTabByLinkId('#tablink-settings', e.target);
        });
        // FIX: use the tab LINK id, not the pane id
        document.getElementById("openSecurityTab")?.addEventListener("click", e => {
            e.preventDefault(); openTabByLinkId('#tablink-verification', e.target);
        });
        // FIX: wallet link id is #tablink-wallet (not billing)
        document.getElementById("openBillingTab")?.addEventListener("click", e => {
            e.preventDefault(); openTabByLinkId('#tablink-wallet', e.target);
        });


        // helper
        const $ = (s, r = document) => r.querySelector(s);
        const show = el => el.classList.remove('d-none');
        const hide = el => el.classList.add('d-none');

        // Ensure .btn-brand uses your gradient (alias to .btn)
        document.head.insertAdjacentHTML('beforeend', `
                <style>.btn-brand{background:linear-gradient(90deg,var(--accent2),var(--accent1));color:var(--btn-text);box-shadow:0 6px 20px rgba(0,112,255,.12);}</style>
  `);

        // Forgot: send link
        $('#forgotForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            hide($('#fpAlertSuccess')); hide($('#fpAlertError'));
            const email = $('#fpEmail').value.trim();

            // basic email check
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                $('#fpEmail').classList.add('is-invalid'); return;
            } else { $('#fpEmail').classList.remove('is-invalid'); }

            try {
                // TODO: replace with your API call:
                // await fetch('/api/auth/request-reset', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email}) });
                await new Promise(r => setTimeout(r, 600)); // demo
                show($('#fpAlertSuccess'));
            } catch (err) {
                show($('#fpAlertError'));
            }
        });

        // Reset: set new password
        $('#resetForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            hide($('#rpAlertSuccess')); hide($('#rpAlertError'));

            const p1 = $('#rpNew').value;
            const p2 = $('#rpNew2').value;
            let ok = true;

            if (p1.length < 8) { $('#rpNew').classList.add('is-invalid'); ok = false; } else { $('#rpNew').classList.remove('is-invalid'); }
            if (p2 !== p1 || !p2) { $('#rpNew2').classList.add('is-invalid'); ok = false; } else { $('#rpNew2').classList.remove('is-invalid'); }
            if (!ok) return;

            try {
                const token = new URLSearchParams(location.search).get('token') || 'demo-token';
                // TODO: replace with your API call:
                // await fetch('/api/auth/reset-password', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({token, password:p1}) });
                await new Promise(r => setTimeout(r, 650)); // demo
                show($('#rpAlertSuccess'));
            } catch (err) {
                show($('#rpAlertError'));
            }
        });

        // If we have ?token=... in URL, open Reset modal automatically
        (function autoOpenResetIfToken() {
            const params = new URLSearchParams(location.search);
            if (params.has('token')) {
                const resetModal = new bootstrap.Modal(document.getElementById('resetModal'));
                resetModal.show();
            }
        })();

        // ===== PROFILE TAB: Edit / Cancel / Save (with outside-form selects) =====
        (function () {
            const pane = document.getElementById('tab-profile');
            if (!pane) return;

            // Buttons
            const btnEdit = pane.querySelector('#btnEditProfile');
            const btnCancel = pane.querySelector('#btnCancelEdit');
            const btnSave = pane.querySelector('#btnSaveProfile');

            // Form + fields
            const form = pane.querySelector('#profileForm');
            const avatarInput = pane.querySelector('#avatarInput');
            const avatarPrev = pane.querySelector('#avatarPreview');
            const switch2FA = pane.querySelector('#switch2FA');
            const switchEmail = pane.querySelector('#switchEmailNotif');
            const toastEl = document.getElementById('profileToast');

            // ---------- helpers (UPDATED) ----------
            // Find any control by name whether it's inside the form OR linked via form="profileForm"
            function findField(name) {
                return (
                    pane.querySelector(`#profileForm [name="${name}"]`) ||
                    pane.querySelector(`[form="profileForm"][name="${name}"]`)
                );
            }

            // All editable controls: inside the form OR associated via form="profileForm"
            const $allEditable = () =>
                Array.from(
                    pane.querySelectorAll(
                        '#profileForm input, #profileForm select, #profileForm textarea, [form="profileForm"]'
                    )
                )
                    .concat([switch2FA, switchEmail, avatarInput])
                    .filter(Boolean);

            // Snapshot for Cancel
            let snapshot = null;

            function readForm() {
                // FormData includes associated controls with form="profileForm"
                const data = Object.fromEntries(new FormData(form).entries());
                data.twofa = !!(switch2FA && switch2FA.checked);
                data.emailNotif = !!(switchEmail && switchEmail.checked);
                data.avatar = avatarPrev?.src || '';
                return data;
            }

            function writeForm(data) {
                for (const [k, v] of Object.entries(data)) {
                    const el = findField(k);
                    if (el) {
                        // only set if option exists (avoids blanking selects with unexpected values)
                        if (el.tagName === 'SELECT') {
                            const has = [...el.options].some(o => o.value === v || o.text === v);
                            el.value = has ? v : el.value;
                        } else {
                            el.value = v;
                        }
                    }
                }
                if (typeof data.twofa !== 'undefined' && switch2FA) switch2FA.checked = !!data.twofa;
                if (typeof data.emailNotif !== 'undefined' && switchEmail) switchEmail.checked = !!data.emailNotif;
                if (data.avatar && avatarPrev) avatarPrev.src = data.avatar;
            }

            function loadFromStorage() {
                const LS_PROFILE = JSON.parse(localStorage.getItem('tpt_demo_profile') || '{}');
                const LS_PREFS = JSON.parse(localStorage.getItem('tpt_demo_prefs') || '{}');

                const [firstName = '', ...rest] = (LS_PROFILE.name || 'Friend').split(' ');
                const lastName = rest.join(' ') || 'User';

                const data = {
                    firstName, lastName,
                    email: LS_PROFILE.email || 'friend@example.com',
                    phone: LS_PROFILE.phone || '',
                    country: LS_PROFILE.country || 'Nigeria',
                    city: LS_PROFILE.city || 'Lagos',
                    bio: LS_PROFILE.bio || 'Member at TPT M√©xico',
                    // these three are the ones outside the form:
                    lang: LS_PREFS.lang || 'English',
                    tz: LS_PROFILE.tz || 'Africa/Lagos (GMT+1)',
                    theme: LS_PROFILE.theme || 'System',
                    twofa: !!LS_PROFILE.twofa,
                    emailNotif: LS_PREFS.email !== undefined ? !!LS_PREFS.email : true,
                    avatar: LS_PROFILE.avatar || avatarPrev?.src || ''
                };
                writeForm(data);
                return data;
            }

            function saveToStorage(data) {
                const profile = {
                    name: [data.firstName, data.lastName].filter(Boolean).join(' ') || 'Friend',
                    email: data.email,
                    phone: data.phone,
                    city: data.city,
                    country: data.country,
                    bio: data.bio,
                    tz: data.tz,           // save time zone
                    theme: data.theme,     // save theme
                    twofa: !!data.twofa,
                    avatar: data.avatar || avatarPrev?.src || ''
                };
                const prefs = {
                    ...(JSON.parse(localStorage.getItem('tpt_demo_prefs') || '{}')),
                    email: !!data.emailNotif,
                    lang: data.lang || 'English' // save language
                };

                localStorage.setItem('tpt_demo_profile', JSON.stringify(profile));
                localStorage.setItem('tpt_demo_prefs', JSON.stringify(prefs));

                const usernameTop = document.getElementById('usernameTop');
                if (usernameTop) usernameTop.textContent = profile.name || 'Friend';
            }

            function setEditMode(on) {
                $allEditable().forEach(el => {
                    if (!el) return;
                    if (on) el.removeAttribute('disabled');
                    else el.setAttribute('disabled', 'disabled');
                });

                if (on) {
                    btnEdit?.classList.add('d-none');
                    btnCancel?.classList.remove('d-none');
                    btnSave?.classList.remove('d-none');
                } else {
                    btnEdit?.classList.remove('d-none');
                    btnCancel?.classList.add('d-none');
                    btnSave?.classList.add('d-none');
                }
            }

            // Avatar preview
            avatarInput?.addEventListener('change', (e) => {
                const f = e.target.files?.[0];
                if (!f) return;
                const reader = new FileReader();
                reader.onload = () => { if (avatarPrev) avatarPrev.src = reader.result; };
                reader.readAsDataURL(f);
            });

            // Wire buttons
            btnEdit?.addEventListener('click', () => {
                snapshot = readForm();
                setEditMode(true);
            });

            btnCancel?.addEventListener('click', () => {
                if (snapshot) writeForm(snapshot);
                setEditMode(false);
            });

            btnSave?.addEventListener('click', (e) => {
                e.preventDefault();
                if (!form.checkValidity()) { form.classList.add('was-validated'); return; }
                const data = readForm();
                saveToStorage(data);
                setEditMode(false);
                if (toastEl) bootstrap.Toast.getOrCreateInstance(toastEl).show();
            });

            // Init
            loadFromStorage();
            setEditMode(false);
        })();

        // ===== CHANGE PASSWORD BUTTON -> OPEN SETTINGS TAB =====
        document.getElementById("btnChangePassword")?.addEventListener("click", e => {
            e.preventDefault();

            // Target the sidebar/tab link that opens the Settings tab
            const tabLink = document.querySelector('#tablink-settings');
            if (tabLink) {
                // use Bootstrap Tab API to show it
                const tab = new bootstrap.Tab(tabLink);
                tab.show();

                // optional: scroll into view / focus Security section
                setTimeout(() => {
                    const secForm = document.getElementById('formSecurity');
                    secForm?.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    secForm?.querySelector('input')?.focus();
                }, 250);
            }
        });


        (function(){
  const ACK_KEY = 'tpt_policy_ack_v1';
        const lastUpdated = '2025-01-15'; // set your real date here

        // Stamps
        document.getElementById('polYear')?.replaceChildren(new Date().getFullYear());
        document.getElementById('polLastUpdated')?.replaceChildren(new Date(lastUpdated).toLocaleDateString());

        // Restore acceptance
        const accept = document.getElementById('polAccept');
        if (accept) accept.checked = localStorage.getItem(ACK_KEY) === 'true';

  // Accept & Continue
  document.getElementById('polContinueBtn')?.addEventListener('click', () => {
    const c = document.getElementById('polAccept');
        if (!c?.checked) {alert('Please read and tick ‚ÄúI‚Äôve read & agree‚Äù.'); return; }
        localStorage.setItem(ACK_KEY, 'true');

        // Optional: jump to Support or back to where user came from
        // new bootstrap.Tab(document.querySelector('#tablink-overview')).show();
        alert('Thanks! Your acceptance was saved for this device.');
  });

  // Print / Save
  document.getElementById('polPrintBtn')?.addEventListener('click', () => window.print());

  // Go to Support tab
  document.getElementById('polGoSupport')?.addEventListener('click', (e) => {
            e.preventDefault();
        const link = document.querySelector('#tablink-support');
        if (link) new bootstrap.Tab(link).show();
  });

        // Enable Bootstrap scrollspy (needs container with data-bs-spy)
        const cont = document.querySelector('.policy-content');
        if (cont) {
            bootstrap.ScrollSpy.getInstance(cont) || new bootstrap.ScrollSpy(cont, {
                target: '#policyNav', rootMargin: '0px 0px -60%'
            });
  }
})();

   
        (function(){
  const ACK_KEY = 'tpt_policy_ack_v1';

        // === Reading progress ===
        const content = document.querySelector('.policy-content');
        const bar = document.getElementById('polProgressBar');
        function updateProgress(){
    if(!content || !bar) return;
        const s = content.scrollTop;
        const h = content.scrollHeight - content.clientHeight;
        const pct = Math.max(0, Math.min(1, h ? s / h : 0));
        bar.style.width = (pct * 100) + '%';
        // Show CTA after ~40% read if not yet accepted
        if (!localStorage.getItem(ACK_KEY)) {
            document.getElementById('polCta')?.classList.toggle('show', pct > .4);
    }
  }
        content?.addEventListener('scroll', updateProgress);
        updateProgress();

        // === Mirror checkbox & accept from floating CTA ===
        const acceptTop = document.getElementById('polAccept');
        const acceptFloat = document.getElementById('polAccept2');
        const btnFloat = document.getElementById('polContinueBtn2');

        // Sync initial state
        if (acceptTop && acceptFloat) acceptFloat.checked = acceptTop.checked;

        function acceptAndStore(){
    const checked = (acceptTop?.checked || acceptFloat?.checked);
        if(!checked){alert('Please tick ‚ÄúI agree‚Äù first.'); return; }
        localStorage.setItem(ACK_KEY, 'true');
        document.getElementById('polCta')?.classList.remove('show');
        alert('Thanks! Your acceptance was saved on this device.');
  }

  acceptTop?.addEventListener('change', () => {
    if (acceptFloat) acceptFloat.checked = acceptTop.checked;
  });
  acceptFloat?.addEventListener('change', () => {
    if (acceptTop) acceptTop.checked = acceptFloat.checked;
  });

        document.getElementById('polContinueBtn')?.addEventListener('click', acceptAndStore);
        btnFloat?.addEventListener('click', acceptAndStore);
})();

        (function(){
  // ====== Support draft + submit (demo) ======
  const LS_SUPPORT_TICKETS = 'tpt_support_tickets';
        const LS_SUPPORT_DRAFT   = 'tpt_support_draft';

  const $ = (s, r=document)=>r.querySelector(s);
        const emailEl = $('#supEmail');
        const subEl   = $('#supSub');
        const catEl   = $('#supCat');
        const priEl   = $('#supPri');
        const msgEl   = $('#supMsg');
        const fileEl  = $('#supFile');
        const fileNameEl = $('#supFileName');
        const countEl = $('#supCount');
        const form    = $('#formSupport');
        const sendBtn = $('#supSendBtn');
        const success = $('#supSuccess');
        const ticketIdEl = $('#supTicketId');
        const copyBtn = $('#supCopyEmail');

        // Prefill user email if you store it in profile
        try {
    const prof = JSON.parse(localStorage.getItem('tpt_demo_profile')||'{ }');
        if (prof.email && emailEl) emailEl.value = prof.email;
  } catch { }

  // Autosave draft
        function saveDraft(){
    const draft = {
            email: emailEl?.value || '',
        sub: subEl?.value || '',
        cat: catEl?.value || 'General',
        pri: priEl?.value || 'Normal',
        msg: msgEl?.value || ''
    };
        localStorage.setItem(LS_SUPPORT_DRAFT, JSON.stringify(draft));
  }
        function loadDraft(){
    const d = JSON.parse(localStorage.getItem(LS_SUPPORT_DRAFT) || 'null');
        if (!d) return;
        if (emailEl) emailEl.value = d.email || emailEl.value;
        if (subEl) subEl.value = d.sub || '';
        if (catEl) catEl.value = d.cat || 'General';
        if (priEl) priEl.value = d.pri || 'Normal';
        if (msgEl) msgEl.value = d.msg || '';
        updateCount();
  }
        function clearDraft(){
            localStorage.removeItem(LS_SUPPORT_DRAFT);
  }

        function updateCount(){
    if (!msgEl || !countEl) return;
        countEl.textContent = String(msgEl.value.length);
  }

  msgEl?.addEventListener('input', ()=>{updateCount(); saveDraft(); });
  [emailEl, subEl, catEl, priEl].forEach(el => el?.addEventListener('input', saveDraft));
  fileEl?.addEventListener('change', ()=>{
            fileNameEl.textContent = fileEl.files?.[0]?.name ? `Attached: ${fileEl.files[0].name}` : '';
  });

  // Quick templates
  document.querySelectorAll('[data-sup-template]').forEach(a=>{
            a.addEventListener('click', (e) => {
                const t = a.getAttribute('data-sup-template');
                if (t === 'verification') {
                    subEl.value = 'Verification help';
                    catEl.value = 'Verification';
                    msgEl.value = 'Hello Support, my verification is pending. I uploaded documents on [date]. Please advise on next steps.';
                } else if (t === 'payment') {
                    subEl.value = 'Payment/receipt assistance';
                    catEl.value = 'Payments';
                    msgEl.value = 'Hi, I sent a payment for request [ID] on [date]. Attached is the receipt. Could you confirm processing?';
                } else if (t === 'abuse') {
                    subEl.value = 'Abuse report';
                    catEl.value = 'Abuse/Report';
                    msgEl.value = 'I would like to report a policy violation. Details: [who/what/when]. I consent to share the info privately with reviewers.';
                } else {
                    subEl.value = 'Question about my account';
                    catEl.value = 'Account';
                    msgEl.value = 'Hello, I have a question about my account settings‚Ä¶';
                }
                priEl.value = 'Normal';
                updateCount(); saveDraft();
            });
  });

  // Copy support email
  copyBtn?.addEventListener('click', async ()=>{
    try{
            await navigator.clipboard.writeText('support@tpt.example');
        const old = copyBtn.innerHTML;
        copyBtn.innerHTML = '<i class="bi bi-clipboard-check me-1"></i>Copied!';
      setTimeout(()=> copyBtn.innerHTML = old, 1200);
    }catch{ }
  });

  // Submit -> store local "ticket" (demo)
  form?.addEventListener('submit', async (e)=>{
            e.preventDefault();
        if (!form.checkValidity()){form.classList.add('was-validated'); return; }

        // Loading state
        sendBtn.disabled = true;
        sendBtn.querySelector('span').textContent = 'Sending‚Ä¶';

    // Simulate network
    await new Promise(r=>setTimeout(r, 650));

        const id = 'ST-' + Math.random().toString(36).slice(2,7).toUpperCase();
        const payload = {
            id,
            at: new Date().toISOString(),
        email: emailEl.value.trim(),
        subject: subEl.value.trim(),
        category: catEl.value,
        priority: priEl.value,
        message: msgEl.value.trim(),
        file: fileEl.files?.[0]?.name || ''
    };

        // Save ticket list
        const all = JSON.parse(localStorage.getItem(LS_SUPPORT_TICKETS) || '[]');
        all.unshift(payload);
        localStorage.setItem(LS_SUPPORT_TICKETS, JSON.stringify(all));

        // Show success
        ticketIdEl.textContent = id;
        success.classList.remove('d-none');

        // Optionally, also open the Messages tab and start a thread (demo-friendly)
        try{
      const MSG = 'tpt_demo_messages';
        const list = JSON.parse(localStorage.getItem(MSG) || '[]');
        list.unshift({
            id, title: `Support: ${payload.subject}`, with: 'Support',
        last: payload.at, thread: [
          { me: true, text: payload.message.slice(0,200), at: payload.at }
        ]
      });
      localStorage.setItem(MSG, JSON.stringify(list));
    }catch{}

    // Reset UI
    form.reset();
    fileNameEl.textContent = '';
    updateCount();
    clearDraft();

    sendBtn.disabled = false;
    sendBtn.querySelector('span').textContent = 'Send';
  });

  // Clear draft button
  $('#supResetDraft')?.addEventListener('click', ()=>{
    form.reset();
    fileNameEl.textContent = '';
    updateCount();
    clearDraft();
  });

  // FAQ search (by text + data-tags)
  const faqSearch = $('#faqSearch');
  const faqItems = [...document.querySelectorAll('#helpFaq .accordion-item')];
  faqSearch?.addEventListener('input', ()=>{
    const q = faqSearch.value.toLowerCase().trim();
    faqItems.forEach(item=>{
      const text = item.textContent.toLowerCase();
      const tags = (item.getAttribute('data-tags') || '').toLowerCase();
      const hit = !q || text.includes(q) || tags.includes(q);
      item.style.display = hit ? '' : 'none';
    });
  });

  // Link to Messages tab
  $('#openMessagesFromSupport')?.addEventListener('click', (e)=>{
    e.preventDefault();
    const link = document.querySelector('#tablink-messages');
    if (link){
      const tab = new bootstrap.Tab(link);
      tab.show();
      setTimeout(()=> document.getElementById('msgList')?.scrollIntoView({behavior:'smooth'}), 250);
    }
  });

  // Init
  loadDraft();
  updateCount();
})();


    </script>
</body>

</html>